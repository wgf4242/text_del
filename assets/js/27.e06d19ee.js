(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{582:function(a,s,t){"use strict";t.r(s);var e=t(4),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h3",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),t("p",[a._v("转自 https://www.cnblogs.com/Triomphe/p/9489639.html")]),a._v(" "),t("p",[a._v("这段时间学习SQL盲注中的报错注入,发现语句就是那么两句,但是一直不知道报错原因,所以看着别人的帖子学习一番,小本本记下来")]),a._v(" "),t("h3",{attrs:{id:"_1-count-rand-group-by"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-count-rand-group-by"}},[a._v("#")]),a._v(" (1) count() , rand() , group by")]),a._v(" "),t("p",[a._v("1.报错语句构造")]),a._v(" "),t("p",[a._v("先直接上两个网上经常使用的报错语句,主要分析第一条,第二条是简化后的")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("　select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a;  \n\n　select count(*) from information_schema.tables group by concat(version(),floor(rand(0)*2));\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[t("a",{attrs:{href:"imgs/Websql_20200614003824_008.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_008.png",alt:"img"}})])]),a._v(" "),t("p",[a._v("可以看出两个句子的原理都是相同的")]),a._v(" "),t("p",[a._v("2.rand() floor()函数")]),a._v(" "),t("p",[a._v("我们现在从最里向外分析整条语句.先从floor(rand(0)*2) 开始")]),a._v(" "),t("ul",[t("li",[a._v("rand()函数会随机产生[0,1)之间的浮点数.")]),a._v(" "),t("li",[a._v("rand()函数可以自己设置随机种子,即rand(N),这个时候产生的随机数是伪随机数.也就是我们多次生成的是相同的.")]),a._v(" "),t("li",[a._v("floor(N)函数会返回一个小于或等于传入参数N的最大整数("),t("strong",[a._v("相当于截断小数部分)")])])]),a._v(" "),t("p",[a._v("先来看一下rand()不设置随机种子的情况.")]),a._v(" "),t("p",[t("a",{attrs:{href:"imgs/Websql_20200614003824_003.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_003.png",alt:"img"}})])]),a._v(" "),t("p",[a._v("可以看出来,连续执行两次的结果是完全不同的.再来看一下设置随机种子后,rand函数的值")]),a._v(" "),t("p",[t("a",{attrs:{href:"imgs/Websql_20200614003824_009.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_009.png",alt:"img"}})])]),a._v(" "),t("p",[a._v("自己可以试一试,多次重复的值是相同的,而这里也是整个报错语句的关键.先加下前6位是 "),t("strong",[a._v("011011")])]),a._v(" "),t("p",[a._v("3 concat()函数 0x3a的作用 别名a")]),a._v(" "),t("ul",[t("li",[a._v("concat()函数将字符串会将字符串拼接起来")]),a._v(" "),t("li",[a._v("0x3a的ASCII码是 : 主要是用来分隔其他字符串,让人可以快速定位重要信息")]),a._v(" "),t("li",[a._v("在括号后面有一个a是别名的意思,是as a的简写.它是前面语句的另一个名字,主要是为了减少重复出现复杂语句")])]),a._v(" "),t("p",[t("a",{attrs:{href:"imgs/Websql_20200614003824_006.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_006.png",alt:"img"}})])]),a._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[a._v("group by 与 count()")])]),a._v(" "),t("ul",[t("li",[a._v("group by a 会根据a的规则对数据进行分组,而分组的时候,mysql会建立一个临时空表进行分组.")]),a._v(" "),t("li",[a._v("count()聚散函数,会进行计数")])]),a._v(" "),t("p",[a._v("5.报错分析")]),a._v(" "),t("p",[a._v("报错的原因是因为**rand()函数在查询的时候会执行一次,插入的时候还会执行一次.**这就是整个语句报错的关键")]),a._v(" "),t("p",[a._v("前面说过floor(rand(0)*2) 前六位是"),t("strong",[a._v("011011")]),a._v(". "),t("strong",[a._v("group by a先建立一个空表,用于分组.")])]),a._v(" "),t("p",[t("code",[a._v("select count(*),(concat(floor(rand(0)*2),'@',(select version())))x from users group by x")])]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("floor(rand(0)*2)")]),a._v(" "),t("th",[a._v("version")]),a._v(" "),t("th",[a._v("拼接")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("0")]),a._v(" "),t("td",[a._v("5.7.19")]),a._v(" "),t("td",[a._v("0@5.7.19")])]),a._v(" "),t("tr",[t("td",[a._v("1")]),a._v(" "),t("td",[a._v("5.7.19")]),a._v(" "),t("td",[a._v("1@5.7.19")])]),a._v(" "),t("tr",[t("td",[a._v("1")]),a._v(" "),t("td",[a._v("5.7.19")]),a._v(" "),t("td",[a._v("1@5.7.19")])]),a._v(" "),t("tr",[t("td",[a._v("0")]),a._v(" "),t("td",[a._v("5.7.19")]),a._v(" "),t("td",[a._v("0@5.7.19")])]),a._v(" "),t("tr",[t("td",[a._v("1")]),a._v(" "),t("td",[a._v("5.7.19")]),a._v(" "),t("td",[a._v("1@5.7.19")])])])]),a._v(" "),t("p",[a._v("先是空白表")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[a._v("count(*)")])]),a._v(" "),t("th",[t("strong",[a._v("x")])])])]),a._v(" "),t("tbody",[t("tr",[t("td"),a._v(" "),t("td")])])]),a._v(" "),t("p",[a._v("扫描原始表的第一项时，第一次计算，floor(rand(0)*2)是0，拼接成0@5.7.19的数据项")]),a._v(" "),t("p",[a._v("结果没有，它插入到上表中，")]),a._v(" "),t("p",[a._v("但在插入之前会进行第二次计算，这时变为1@5.7.19，所以虚拟表变成了下面这样")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[a._v("count(*)")])]),a._v(" "),t("th",[t("strong",[a._v("x")])])])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("strong",[a._v("1")])]),a._v(" "),t("td",[t("strong",[a._v("1@5.7.19")])])])])]),a._v(" "),t("p",[a._v("扫描第二项，x=1，拼接'1@5.7.19', 存在，不需要进行第二次计算，直接插入，得到下表：")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[a._v("count(*)")])]),a._v(" "),t("th",[t("strong",[a._v("x")])])])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("strong",[a._v("2")])]),a._v(" "),t("td",[t("strong",[a._v("1@5.7.19")])])])])]),a._v(" "),t("p",[a._v("扫描第三项，第一次计算x==‘0@5.7.19’，虚拟表中找不到，")]),a._v(" "),t("p",[a._v("第二次计算，这时x=='1@5.7.19'插入，虚拟表中已经存在以1@5.7.19为主键的数据项了，插入失败，然后就报错了！")]),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("然后进行分组查询,第一次rand()执行,查询的结果是")]),a._v(" "),t("p",[a._v("0,因为是空表所以插入这条,而插入的时候rand()又执行了一次,所以表中的结果就是")]),a._v(" "),t("p",[t("a",{attrs:{href:"imgs/Websql_20200614003824_000.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_000.png",alt:"img"}})])]),a._v(" "),t("p",[a._v("第一次执行完,接着执行rand()的值为1,因为表中存在,所以加1,表中结果成为")]),a._v(" "),t("p",[t("a",{attrs:{href:"imgs/Websql_20200614003824_005.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_005.png",alt:"img"}})])]),a._v(" "),t("p",[a._v("到了第三次执行rand()是值为0,因为表中不存在所以要插入新的数据,"),t("strong",[a._v("这次插入rand()再次执行,所以插入的又是1.而表中已经存在1了")])]),a._v(" "),t("p",[t("strong",[a._v("此时插入因为重复出现同一个key,就会出现报错 重复出现key.而报错中会说明那个key有问题,我们的key中结合了想要了解的字符串root@localhost")])]),a._v(" "),t("p",[t("strong",[a._v("这样就实现了报错注入,拿到了自己想要的数据")])]),a._v(" "),t("p",[t("strong",[t("a",{attrs:{href:"imgs/Websql_20200614003824_007.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_007.png",alt:"img"}})])])]),a._v(" "),t("p",[a._v("这就是整个报错注入的原理了,rand(),floor() group by 函数缺一不可.")]),a._v(" "),t("h3",{attrs:{id:"_2-xml函数之extractvalue"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-xml函数之extractvalue"}},[a._v("#")]),a._v(" (2) XML函数之ExtractValue()")]),a._v(" "),t("p",[a._v("1.报错语句构造")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("select extractvalue(1,concat(0x7e,user(),0x7e))\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("1 mysql> select extractvalue(1,concat(0x7e,user(),0x7e));\n2 ERROR 1105 (HY000): XPATH syntax error: '~root@localhost~'\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("2.ExtractValue()函数")]),a._v(" "),t("ul",[t("li",[a._v("ExtractValue(xml_str , Xpath) 函数,使用Xpath表示法从XML格式的字符串中提取一个值")]),a._v(" "),t("li",[a._v("ExtractValue()函数中任意一个参数为NULL,返回值都是NULL.")])]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("1 mysql> select extractvalue('<a><b>abbb</b><c>accc<b>acbbbb</b></c>aaaa</a>','/a/c');\n2 +-----------------------------------------------------------------------+\n3 | extractvalue('<a><b>abbb</b><c>accc<b>acbbbb</b></c>aaaa</a>','/a/c') |\n4 +-----------------------------------------------------------------------+\n5 | accc                                                                  |\n6 +-----------------------------------------------------------------------+\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("1 mysql> select extractvalue('<a><b>abbb</b><c>accc<b>acbbbb</b></c>aaaa</a>',NULL);\n2 +---------------------------------------------------------------------+\n3 | extractvalue('<a><b>abbb</b><c>accc<b>acbbbb</b></c>aaaa</a>',NULL) |\n4 +---------------------------------------------------------------------+\n5 | NULL                                                                |\n6 +---------------------------------------------------------------------+\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("3.报错分析")]),a._v(" "),t("p",[a._v("上面说明了正常情况下的extractvalue函数使用方法,Xpath语法可以自行google.但是如果我们构造了")]),a._v(" "),t("p",[t("strong",[a._v("不符合规定的Xpath,MySQL就会报语法错误,并显示XPath的内容.")])]),a._v(" "),t("p",[t("strong",[a._v("但是什么样子的字符串会引发报错呢.")])]),a._v(" "),t("p",[t("strong",[t("a",{attrs:{href:"imgs/Websql_20200614003824_001.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_001.png",alt:"img"}})])])]),a._v(" "),t("p",[a._v("发现报错竟然消失了一部分,前面的root不见了."),t("strong",[a._v("因为XPATH语法报错的是那些特殊字符,遇到特殊字符就会报错.")])]),a._v(" "),t("p",[t("strong",[a._v("所以0x7e,ASCII码是~ 就会从头开始报错.")])]),a._v(" "),t("p",[t("a",{attrs:{href:"imgs/Websql_20200614003824_004.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_004.png",alt:"img"}})])]),a._v(" "),t("p",[a._v("可以看出来报错会从"),t("strong",[a._v("遇到的第一个特殊字符处开始报错")]),a._v(".直到结束.但是"),t("strong",[a._v("报错的长度是有限制的")]),a._v(".如下图应该出现")]),a._v(" "),t("p",[a._v("字符串最后并没全部显示出来,而是后面的字符串被截断了.")]),a._v(" "),t("p",[t("a",{attrs:{href:"imgs/Websql_20200614003824_002.png"}},[t("img",{attrs:{src:"imgs/Websql_20200614003824_002.png",alt:"img"}})])]),a._v(" "),t("h3",{attrs:{id:"_3-xml函数之updatexml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-xml函数之updatexml"}},[a._v("#")]),a._v(" (3)XML函数之updatexml()")]),a._v(" "),t("p",[a._v("1.报错语句")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("select updatexml(1,concat(0x7e,version(),0x7e),1) \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysql> select updatexml(1,concat(0x7e,version(),0x7e),1);\nERROR 1105 (HY000): XPATH syntax error: '~5.7.19~'\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("2.updatexml()函数")]),a._v(" "),t("p",[a._v("updatexml(xml,xpath,new_xml),此函数使用nex_xml根据xpath来替换xml字符串中特定的值.和上面的道理是相同的,都是通过xpath语法")]),a._v(" "),t("p",[a._v("错误来报错.原来也和上面的相同.不再具体描述.")]),a._v(" "),t("h3",{attrs:{id:"_4-name-const-重复报错-不推荐"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-name-const-重复报错-不推荐"}},[a._v("#")]),a._v(" (4) name_const() 重复报错(不推荐)")]),a._v(" "),t("p",[a._v("1.报错语句构造")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))a;\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("1 mysql> select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))a;\n2 ERROR 1060 (42S21): Duplicate column name '5.7.19'\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("2.name_const()函数")]),a._v(" "),t("p",[a._v("name_const(name,value)函数会用传入的参数返回一列结果集."),t("strong",[a._v("传入的参数必须是常量")])]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("1 mysql> SELECT NAME_CONST('myname', 14);\n2 +--------+\n3 | myname |\n4 +--------+\n5 |     14 |\n6 +--------+\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("如果传入的参数不是常量,就会报错.")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("1 mysql> select name_const(database(),1);\n2 ERROR 1210 (HY000): Incorrect arguments to NAME_CONST\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("3.报错分析")]),a._v(" "),t("p",[a._v("报错原因就是因为两列列名相同,外面选择时候报错,说重复列.")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("1 mysql> select name_const(version(),1),name_const(version(),1);\n2 +--------+--------+\n3 | 5.7.19 | 5.7.19 |\n4 +--------+--------+\n5 |      1 |      1 |\n6 +--------+--------+\n7 1 row in set (0.00 sec)\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("然而个人认为这个报错注入很鸡肋,没有多大用,尝试了一下只用version()函数可以使用,其他可能因为不是常量的原因.")]),a._v(" "),t("p",[a._v("name_const()函数会报参数错误的错误,不会回显想要的信息.")])])}),[],!1,null,null,null);s.default=n.exports}}]);