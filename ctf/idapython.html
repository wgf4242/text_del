<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wgf4242&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/text_del/assets/css/0.styles.cf9e26c4.css" as="style"><link rel="preload" href="/text_del/assets/js/app.cb1aaf83.js" as="script"><link rel="preload" href="/text_del/assets/js/4.1570c86b.js" as="script"><link rel="preload" href="/text_del/assets/js/1.9204637f.js" as="script"><link rel="preload" href="/text_del/assets/js/40.0956c3db.js" as="script"><link rel="prefetch" href="/text_del/assets/js/10.a1a16f3b.js"><link rel="prefetch" href="/text_del/assets/js/11.d0fc4eca.js"><link rel="prefetch" href="/text_del/assets/js/12.f1e7faa4.js"><link rel="prefetch" href="/text_del/assets/js/13.8c951298.js"><link rel="prefetch" href="/text_del/assets/js/14.e961b961.js"><link rel="prefetch" href="/text_del/assets/js/15.aaab3b66.js"><link rel="prefetch" href="/text_del/assets/js/16.43eee05c.js"><link rel="prefetch" href="/text_del/assets/js/17.086027bf.js"><link rel="prefetch" href="/text_del/assets/js/18.3f41df7b.js"><link rel="prefetch" href="/text_del/assets/js/19.efbba28d.js"><link rel="prefetch" href="/text_del/assets/js/2.14fcd092.js"><link rel="prefetch" href="/text_del/assets/js/20.6ca538ec.js"><link rel="prefetch" href="/text_del/assets/js/21.e96a7f20.js"><link rel="prefetch" href="/text_del/assets/js/22.e7c75172.js"><link rel="prefetch" href="/text_del/assets/js/23.d2dbca9e.js"><link rel="prefetch" href="/text_del/assets/js/24.f77110de.js"><link rel="prefetch" href="/text_del/assets/js/25.ad3cdffc.js"><link rel="prefetch" href="/text_del/assets/js/26.8201a049.js"><link rel="prefetch" href="/text_del/assets/js/27.425bb1bd.js"><link rel="prefetch" href="/text_del/assets/js/28.438d9295.js"><link rel="prefetch" href="/text_del/assets/js/29.7e0bc7b5.js"><link rel="prefetch" href="/text_del/assets/js/30.eadc11e6.js"><link rel="prefetch" href="/text_del/assets/js/31.45ea8479.js"><link rel="prefetch" href="/text_del/assets/js/32.77231eb2.js"><link rel="prefetch" href="/text_del/assets/js/33.6d70ab89.js"><link rel="prefetch" href="/text_del/assets/js/34.0df5c65b.js"><link rel="prefetch" href="/text_del/assets/js/35.10cf4eef.js"><link rel="prefetch" href="/text_del/assets/js/36.e754010e.js"><link rel="prefetch" href="/text_del/assets/js/37.eb9ab54f.js"><link rel="prefetch" href="/text_del/assets/js/38.12bcf212.js"><link rel="prefetch" href="/text_del/assets/js/39.c4919376.js"><link rel="prefetch" href="/text_del/assets/js/41.d47c394f.js"><link rel="prefetch" href="/text_del/assets/js/42.0f918ea4.js"><link rel="prefetch" href="/text_del/assets/js/43.b62d29de.js"><link rel="prefetch" href="/text_del/assets/js/44.55c4b907.js"><link rel="prefetch" href="/text_del/assets/js/45.51e42e77.js"><link rel="prefetch" href="/text_del/assets/js/46.e48f7090.js"><link rel="prefetch" href="/text_del/assets/js/47.91e8a65b.js"><link rel="prefetch" href="/text_del/assets/js/48.2732fe72.js"><link rel="prefetch" href="/text_del/assets/js/49.4b469b80.js"><link rel="prefetch" href="/text_del/assets/js/5.988d478d.js"><link rel="prefetch" href="/text_del/assets/js/50.f4d30a6b.js"><link rel="prefetch" href="/text_del/assets/js/51.d650f987.js"><link rel="prefetch" href="/text_del/assets/js/52.24351146.js"><link rel="prefetch" href="/text_del/assets/js/53.d8ac36a9.js"><link rel="prefetch" href="/text_del/assets/js/54.62a75cf7.js"><link rel="prefetch" href="/text_del/assets/js/55.877b162a.js"><link rel="prefetch" href="/text_del/assets/js/6.dd916a57.js"><link rel="prefetch" href="/text_del/assets/js/7.ad32f933.js"><link rel="prefetch" href="/text_del/assets/js/8.714369a0.js"><link rel="prefetch" href="/text_del/assets/js/9.bf061ee9.js">
    <link rel="stylesheet" href="/text_del/assets/css/0.styles.cf9e26c4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-19557b78><div data-v-19557b78><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-19557b78 data-v-19557b78><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-19557b78 data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>wgf4242's Blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>wgf4242's Blog</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-19557b78><header class="navbar" data-v-19557b78><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/text_del/" class="home-link router-link-active"><!----> <span class="site-name">wgf4242's Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/text_del/home/" class="nav-link"><i class="iconfont undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      文章
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/text_del/article/technology/" class="nav-link"><i class="iconfont undefined"></i>
  技术
</a></li><li class="dropdown-item"><!----> <a href="/text_del/article/essay/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/text_del/article/other/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/text_del/about/" class="nav-link"><i class="iconfont undefined"></i>
  关于
</a></div><div class="nav-item"><a href="https://www.github.com/wgf4242" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-19557b78></div> <aside class="sidebar" data-v-19557b78><div class="personal-info-wrapper" data-v-042e23d4><!----> <h3 class="name" data-v-042e23d4>
    wgf4242's Blog
  </h3> <div class="num" data-v-042e23d4><div data-v-042e23d4><h3 data-v-042e23d4>0</h3> <h6 data-v-042e23d4>Article</h6></div> <div data-v-042e23d4><h3 data-v-042e23d4>0</h3> <h6 data-v-042e23d4>Tag</h6></div></div> <hr data-v-042e23d4></div> <nav class="nav-links"><div class="nav-item"><a href="/text_del/home/" class="nav-link"><i class="iconfont undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      文章
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/text_del/article/technology/" class="nav-link"><i class="iconfont undefined"></i>
  技术
</a></li><li class="dropdown-item"><!----> <a href="/text_del/article/essay/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/text_del/article/other/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/text_del/about/" class="nav-link"><i class="iconfont undefined"></i>
  关于
</a></div><div class="nav-item"><a href="https://www.github.com/wgf4242" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>wgf4242's Blog</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-19557b78><main class="page"><div class="page-title" style="display:none;"><h1></h1> <hr> <div data-v-34ea29db><i class="iconfont reco-account" data-v-34ea29db><span data-v-34ea29db>wgf4242's Blog</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><p>Byte(ea) 将地址解释为Byte
Word(ea)
DWord(ea)
QWord(ea)
GetFloat(ea)
GetDouble(ea)
GetString(ea, length = -1, strtype = ASCSTR_C) 获取字符串
GetCurrentLine() 获取光标所在行反汇编</p> <p>ScreenEA()
　　获取 IDA 调试窗口中，光标指向代码的地址。通过这个函数，我们就能够从一个已知 的点运行我们的脚本。</p> <p>GetInputFileMD5()
　　返回 IDA 加载的二进制文件的 MD5 值，通过这个值能够判断一个文件的不同版本是否 有改变。</p> <p>FirstSeg()
　　访问程序中的第一个段。</p> <p>NextSeg()
　　访问下一个段，如果没有就返回 BADADDR。</p> <p>SegByName( string SegmentName )
　　通过段名字返回段基址，举个例子，如果调用.text 作为参数，就会返回程序中代码段的开始位置。</p> <p>SegEnd( long Address )
　　通过段内的某个地址，获得段尾的地址。</p> <p>SegStart( long Address )
　　通过段内的某个地址，获得段头的地址。</p> <p>SegName( long Address )
　　通过段内的某个地址，获得段名。</p> <p>Segments()
　　返回目标程序中的所有段的开始地址。</p> <p>Functions( long StartAddress, long EndAddress )
　　返回一个列表，包含了从 StartAddress 到 EndAddress 之间的所有函数。</p> <p>Chunks( long FunctionAddress )
　　返回一个列表，包含了函数片段。每个列表项都是一个元组（chunk start, chunk end）</p> <p>LocByName( string FunctionName )
　　通过函数名返回函数的地址。</p> <p>GetFuncOffset( long Address )
　　通过任意一个地址，然后得到这个地址所属的函数名，以及给定地址和函数的相对位移。 然后把这些信息组成字符串以&quot;名字+位移&quot;的形式返回。</p> <p>GetFunctionName( long Address )
　　通过一个地址，返回这个地址所属的函数。</p> <p>CodeRefsTo( long Address, bool Flow )
　　返回一个列表，告诉我们 Address 处代码被什么地方引用了，Flow 告诉 IDAPython 是否要 跟踪这些代码。</p> <p>CodeRefsFrom( long Address, bool Flow )
　　返回一个列表，告诉我们 Address 地址上的代码引用何处的代码。</p> <p>DataRefsTo( long Address )
　　返回一个列表，告诉我们 Address 处数据被什么地方引用了。常用于跟踪全局变量。</p> <p>DataRefsFrom( long Address )
　　返回一个列表，告诉我们 Address 地址上的代码引用何处的数据。</p> <p>Heads(start=None, end=None)
　　得到两个地址之间所有的元素</p> <p>GetDisasm(addr)
　　得到addr的反汇编语句</p> <p>GetMnem(addr)
　　得到addr地址的操作码</p> <p>BADADDR
　　验证是不是错误地址</p> <p>GetOpnd(addr，long n)
　　第一个参数是地址，第二个long n是操作数索引。第一个操作数是0和第二个是1。</p> <p>idaapi.decode_insn(ea)
　　得到当前地址指令的长度</p> <p>idc.FindFuncEnd(ea)
　　找到当前地址的函数结束地址</p> <p>Entries()
　　入口点信息</p> <p>Structs()
　　遍历结构体</p> <p>StructMembers(sid)
　　遍历结构体成员</p> <p>DecodePrecedingInstruction(ea) 获取指令结构
DecodePreviousInstruction(ea)
DecodeInstruction(ea)</p> <p>Strings(object) 获取字符串
GetIdbDir() 获取idb目录
GetRegisterList() 获取寄存器名表
GetInstructionList 获取汇编指令表</p> <p>atoa(ea) 获取所在段
Jump(ea) 移动光标
Eval(expr) 计算表达式
Exec(command) 执行命令行
MakeCode(ea) 分析代码区
MakeNameEx(ea, name, flags) 重命名地址
MakeArray(ea, nitems) 创建数组
MakeStr(ea, endea) 创建字符串
MakeData(ea, flags, size, tid) 创建数据
MakeByte(ea)
MakeWord(ea)
MakeDWord(ea)
MakeQWord(ea)
MakeOWord(ea)
MakeYWord(ea)
MakeFlot(ea)
MakeDouble(ea)
MakePackReal(ea)
MakeTbyte(ea)
MakeStructEx(ea)
MakeCustomDataEx(ea)</p> <p>PatchByte(ea, value) 修改程序字节
PatchWord(ea, value)
PatchDword(ea, value)
PatchByte(ea, value)
PatchByte(ea, value)</p> <p>Byte(ea) 将地址解释为Byte
Word(ea)
DWord(ea)
QWord(ea)
GetFloat(ea)
GetDouble(ea)
GetString(ea, length = -1, strtype = ASCSTR_C) 获取字符串
GetCurrentLine() 获取光标所在行反汇编</p> <p>ItemSize(ea) 获取指令或数据长度</p> <p>FindText(ea, flag, y, x, searchstr)查找文本
FindBinary(ea, flag, searchstr, radix=16) 查找16进制</p> <p>GetEntryPointQty() 获取入口点个数
GetEntryOrdinal(index) 获取入口点地址
GetEntryName(ordinal) 入口名</p> <p>idc.GetFunctionAttr(ea, attr) //得到当前地址所在函数的数据
(
FUNCATTR_START = 0 # function start address
FUNCATTR_END = 4 # function end address
FUNCATTR_FLAGS = 8 # function flags
FUNCATTR_FRAME = 10 # function frame id
FUNCATTR_FRSIZE = 14 # size of local variables
FUNCATTR_FRREGS = 18 # size of saved registers area
FUNCATTR_ARGSIZE = 20 # number of bytes purged from the stack
FUNCATTR_FPD = 24 # frame pointer delta
FUNCATTR_COLOR = 28 # function color code
FUNCATTR_OWNER = 10 # chunk owner (valid only for tail chunks)
FUNCATTR_REFQTY = 14 # number of chunk parents (valid only for tail chunks)
)</p> <p>class DbgHook(DBG_Hooks):</p> <h1 id="event-handler-for-when-the-process-starts"><a href="#event-handler-for-when-the-process-starts" class="header-anchor">#</a> Event handler for when the process starts</h1> <p>def dbg_process_start(self, pid, tid, ea, name, base, size)
return</p> <h1 id="event-handler-for-process-exit"><a href="#event-handler-for-process-exit" class="header-anchor">#</a> Event handler for process exit</h1> <p>def dbg_process_exit(self, pid, tid, ea, code):
return</p> <h1 id="event-handler-for-when-a-shared-library-gets-loaded-def"><a href="#event-handler-for-when-a-shared-library-gets-loaded-def" class="header-anchor">#</a> Event handler for when a shared library gets loaded def</h1> <p>dbg_library_load(self, pid, tid, ea, name, base, size):
return</p> <h1 id="breakpoint-handler"><a href="#breakpoint-handler" class="header-anchor">#</a> Breakpoint handler</h1> <p>def dbg_bpt(self, tid, ea):
return</p> <p>这个类包含了我们在创建调试脚本时，会经常用到的几个调试事件处理函数。安装 hook 的方式如下:
debugger = DbgHook()
debugger.hook()
现在运行调试器，hook 会捕捉所有的调试事件，这样就能非常精确的控制 IDA 调试器。 下面的函数在调试的时候非常有用:
AddBpt( long Address )
在指定的地点设置软件断点。
GetBptQty()
返回当前设置的断点数量。
GetRegValue( string Register )
通过寄存器名获得寄存器值。
SetRegValue( long Value, string Register )</p> <p>这个是用IDApytohon编写的查找strcpy函数以及他的参数是否在栈区域</p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/text_del/assets/js/app.cb1aaf83.js" defer></script><script src="/text_del/assets/js/4.1570c86b.js" defer></script><script src="/text_del/assets/js/1.9204637f.js" defer></script><script src="/text_del/assets/js/40.0956c3db.js" defer></script>
  </body>
</html>
